/*!
 * Copyright N/A (see below)
 *
 * This is a wrapper for dependencies. See individual libs for Copyright info
 *
 */
;if(typeof[].map!=="function"){
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/master/LICENSE
 */
;(function(root,factory){if(typeof define==="function"&&define.amd){define(factory);}else{if(typeof exports==="object"){module.exports=factory();}else{root.returnExports=factory();}}}(this,function(){var $Array=Array;var ArrayPrototype=$Array.prototype;var $Object=Object;var ObjectPrototype=$Object.prototype;var $Function=Function;var FunctionPrototype=$Function.prototype;var $String=String;var StringPrototype=$String.prototype;var $Number=Number;var NumberPrototype=$Number.prototype;var array_slice=ArrayPrototype.slice;var array_splice=ArrayPrototype.splice;var array_push=ArrayPrototype.push;var array_unshift=ArrayPrototype.unshift;var array_concat=ArrayPrototype.concat;var array_join=ArrayPrototype.join;var call=FunctionPrototype.call;var apply=FunctionPrototype.apply;var max=Math.max;var min=Math.min;var to_string=ObjectPrototype.toString;var hasToStringTag=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var isCallable;var fnToStr=Function.prototype.toString,constructorRegex=/^\s*class /,isES6ClassFn=function isES6ClassFn(value){try{var fnStr=fnToStr.call(value);var singleStripped=fnStr.replace(/\/\/.*\n/g,"");var multiStripped=singleStripped.replace(/\/\*[.\s\S]*\*\//g,"");var spaceStripped=multiStripped.replace(/\n/mg," ").replace(/ {2}/g," ");return constructorRegex.test(spaceStripped);}catch(e){return false;}},tryFunctionObject=function tryFunctionObject(value){try{if(isES6ClassFn(value)){return false;}fnToStr.call(value);return true;}catch(e){return false;}},fnClass="[object Function]",genClass="[object GeneratorFunction]",isCallable=function isCallable(value){if(!value){return false;}if(typeof value!=="function"&&typeof value!=="object"){return false;}if(hasToStringTag){return tryFunctionObject(value);}if(isES6ClassFn(value)){return false;}var strClass=to_string.call(value);return strClass===fnClass||strClass===genClass;};var isRegex;var regexExec=RegExp.prototype.exec,tryRegexExec=function tryRegexExec(value){try{regexExec.call(value);return true;}catch(e){return false;}},regexClass="[object RegExp]";isRegex=function isRegex(value){if(typeof value!=="object"){return false;}return hasToStringTag?tryRegexExec(value):to_string.call(value)===regexClass;};var isString;var strValue=String.prototype.valueOf,tryStringObject=function tryStringObject(value){try{strValue.call(value);return true;}catch(e){return false;}},stringClass="[object String]";isString=function isString(value){if(typeof value==="string"){return true;}if(typeof value!=="object"){return false;}return hasToStringTag?tryStringObject(value):to_string.call(value)===stringClass;};var supportsDescriptors=$Object.defineProperty&&(function(){try{var obj={};$Object.defineProperty(obj,"x",{enumerable:false,value:obj});for(var _ in obj){return false;}return obj.x===obj;}catch(e){return false;}}());var defineProperties=(function(has){var defineProperty;if(supportsDescriptors){defineProperty=function(object,name,method,forceAssign){if(!forceAssign&&(name in object)){return;}$Object.defineProperty(object,name,{configurable:true,enumerable:false,writable:true,value:method});};}else{defineProperty=function(object,name,method,forceAssign){if(!forceAssign&&(name in object)){return;}object[name]=method;};}return function defineProperties(object,map,forceAssign){for(var name in map){if(has.call(map,name)){defineProperty(object,name,map[name],forceAssign);}}};}(ObjectPrototype.hasOwnProperty));var isPrimitive=function isPrimitive(input){var type=typeof input;return input===null||(type!=="object"&&type!=="function");};var isActualNaN=$Number.isNaN||function isActualNaN(x){return x!==x;};var ES={ToInteger:function ToInteger(num){var n=+num;if(isActualNaN(n)){n=0;}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n));}}return n;},ToPrimitive:function ToPrimitive(input){var val,valueOf,toStr;if(isPrimitive(input)){return input;}valueOf=input.valueOf;if(isCallable(valueOf)){val=valueOf.call(input);if(isPrimitive(val)){return val;}}toStr=input.toString;if(isCallable(toStr)){val=toStr.call(input);if(isPrimitive(val)){return val;}}throw new TypeError();},ToObject:function(o){if(o==null){throw new TypeError("can't convert "+o+" to object");}return $Object(o);},ToUint32:function ToUint32(x){return x>>>0;}};var Empty=function Empty(){};defineProperties(FunctionPrototype,{bind:function bind(that){var target=this;if(!isCallable(target)){throw new TypeError("Function.prototype.bind called on incompatible "+target);}var args=array_slice.call(arguments,1);var bound;var binder=function(){if(this instanceof bound){var result=apply.call(target,this,array_concat.call(args,array_slice.call(arguments)));if($Object(result)===result){return result;}return this;}else{return apply.call(target,that,array_concat.call(args,array_slice.call(arguments)));}};var boundLength=max(0,target.length-args.length);var boundArgs=[];for(var i=0;i<boundLength;i++){array_push.call(boundArgs,"$"+i);}bound=$Function("binder","return function ("+array_join.call(boundArgs,",")+"){ return binder.apply(this, arguments); }")(binder);if(target.prototype){Empty.prototype=target.prototype;bound.prototype=new Empty();Empty.prototype=null;}return bound;}});var owns=call.bind(ObjectPrototype.hasOwnProperty);var toStr=call.bind(ObjectPrototype.toString);var arraySlice=call.bind(array_slice);var arraySliceApply=apply.bind(array_slice);var strSlice=call.bind(StringPrototype.slice);var strSplit=call.bind(StringPrototype.split);var strIndexOf=call.bind(StringPrototype.indexOf);var pushCall=call.bind(array_push);var isEnum=call.bind(ObjectPrototype.propertyIsEnumerable);var arraySort=call.bind(ArrayPrototype.sort);var isArray=$Array.isArray||function isArray(obj){return toStr(obj)==="[object Array]";};var hasUnshiftReturnValueBug=[].unshift(0)!==1;defineProperties(ArrayPrototype,{unshift:function(){array_unshift.apply(this,arguments);return this.length;}},hasUnshiftReturnValueBug);defineProperties($Array,{isArray:isArray});var boxedString=$Object("a");var splitString=boxedString[0]!=="a"||!(0 in boxedString);var properlyBoxesContext=function properlyBoxed(method){var properlyBoxesNonStrict=true;var properlyBoxesStrict=true;var threwException=false;if(method){try{method.call("foo",function(_,__,context){if(typeof context!=="object"){properlyBoxesNonStrict=false;}});method.call([1],function(){properlyBoxesStrict=typeof this==="string";},"x");}catch(e){threwException=true;}}return !!method&&!threwException&&properlyBoxesNonStrict&&properlyBoxesStrict;};defineProperties(ArrayPrototype,{forEach:function forEach(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var i=-1;var length=ES.ToUint32(self.length);var T;if(arguments.length>1){T=arguments[1];}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.forEach callback must be a function");}while(++i<length){if(i in self){if(typeof T==="undefined"){callbackfn(self[i],i,object);}else{callbackfn.call(T,self[i],i,object);}}}}},!properlyBoxesContext(ArrayPrototype.forEach));defineProperties(ArrayPrototype,{map:function map(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);var result=$Array(length);var T;if(arguments.length>1){T=arguments[1];}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.map callback must be a function");}for(var i=0;i<length;i++){if(i in self){if(typeof T==="undefined"){result[i]=callbackfn(self[i],i,object);}else{result[i]=callbackfn.call(T,self[i],i,object);}}}return result;}},!properlyBoxesContext(ArrayPrototype.map));defineProperties(ArrayPrototype,{filter:function filter(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);var result=[];var value;var T;if(arguments.length>1){T=arguments[1];}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.filter callback must be a function");}for(var i=0;i<length;i++){if(i in self){value=self[i];if(typeof T==="undefined"?callbackfn(value,i,object):callbackfn.call(T,value,i,object)){pushCall(result,value);}}}return result;}},!properlyBoxesContext(ArrayPrototype.filter));defineProperties(ArrayPrototype,{every:function every(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);var T;if(arguments.length>1){T=arguments[1];}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.every callback must be a function");}for(var i=0;i<length;i++){if(i in self&&!(typeof T==="undefined"?callbackfn(self[i],i,object):callbackfn.call(T,self[i],i,object))){return false;}}return true;}},!properlyBoxesContext(ArrayPrototype.every));defineProperties(ArrayPrototype,{some:function some(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);var T;if(arguments.length>1){T=arguments[1];}if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.some callback must be a function");}for(var i=0;i<length;i++){if(i in self&&(typeof T==="undefined"?callbackfn(self[i],i,object):callbackfn.call(T,self[i],i,object))){return true;}}return false;}},!properlyBoxesContext(ArrayPrototype.some));var reduceCoercesToObject=false;if(ArrayPrototype.reduce){reduceCoercesToObject=typeof ArrayPrototype.reduce.call("es5",function(_,__,___,list){return list;})==="object";}defineProperties(ArrayPrototype,{reduce:function reduce(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.reduce callback must be a function");}if(length===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value");}var i=0;var result;if(arguments.length>=2){result=arguments[1];}else{do{if(i in self){result=self[i++];break;}if(++i>=length){throw new TypeError("reduce of empty array with no initial value");}}while(true);}for(;i<length;i++){if(i in self){result=callbackfn(result,self[i],i,object);}}return result;}},!reduceCoercesToObject);var reduceRightCoercesToObject=false;if(ArrayPrototype.reduceRight){reduceRightCoercesToObject=typeof ArrayPrototype.reduceRight.call("es5",function(_,__,___,list){return list;})==="object";}defineProperties(ArrayPrototype,{reduceRight:function reduceRight(callbackfn){var object=ES.ToObject(this);var self=splitString&&isString(this)?strSplit(this,""):object;var length=ES.ToUint32(self.length);if(!isCallable(callbackfn)){throw new TypeError("Array.prototype.reduceRight callback must be a function");}if(length===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value");}var result;var i=length-1;if(arguments.length>=2){result=arguments[1];}else{do{if(i in self){result=self[i--];break;}if(--i<0){throw new TypeError("reduceRight of empty array with no initial value");}}while(true);}if(i<0){return result;}do{if(i in self){result=callbackfn(result,self[i],i,object);}}while(i--);return result;}},!reduceRightCoercesToObject);var hasFirefox2IndexOfBug=ArrayPrototype.indexOf&&[0,1].indexOf(1,2)!==-1;defineProperties(ArrayPrototype,{indexOf:function indexOf(searchElement){var self=splitString&&isString(this)?strSplit(this,""):ES.ToObject(this);var length=ES.ToUint32(self.length);if(length===0){return -1;}var i=0;if(arguments.length>1){i=ES.ToInteger(arguments[1]);}i=i>=0?i:max(0,length+i);for(;i<length;i++){if(i in self&&self[i]===searchElement){return i;}}return -1;}},hasFirefox2IndexOfBug);var hasFirefox2LastIndexOfBug=ArrayPrototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;defineProperties(ArrayPrototype,{lastIndexOf:function lastIndexOf(searchElement){var self=splitString&&isString(this)?strSplit(this,""):ES.ToObject(this);var length=ES.ToUint32(self.length);if(length===0){return -1;}var i=length-1;if(arguments.length>1){i=min(i,ES.ToInteger(arguments[1]));}i=i>=0?i:length-Math.abs(i);for(;i>=0;i--){if(i in self&&searchElement===self[i]){return i;}}return -1;}},hasFirefox2LastIndexOfBug);var spliceNoopReturnsEmptyArray=(function(){var a=[1,2];var result=a.splice();return a.length===2&&isArray(result)&&result.length===0;}());defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){if(arguments.length===0){return[];}else{return array_splice.apply(this,arguments);}}},!spliceNoopReturnsEmptyArray);var spliceWorksWithEmptyObject=(function(){var obj={};ArrayPrototype.splice.call(obj,0,0,1);return obj.length===1;}());defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){if(arguments.length===0){return[];}var args=arguments;this.length=max(ES.ToInteger(this.length),0);if(arguments.length>0&&typeof deleteCount!=="number"){args=arraySlice(arguments);if(args.length<2){pushCall(args,this.length-start);}else{args[1]=ES.ToInteger(deleteCount);}}return array_splice.apply(this,args);}},!spliceWorksWithEmptyObject);var spliceWorksWithLargeSparseArrays=(function(){var arr=new $Array(100000);arr[8]="x";arr.splice(1,1);return arr.indexOf("x")===7;}());var spliceWorksWithSmallSparseArrays=(function(){var n=256;var arr=[];arr[n]="a";arr.splice(n+1,0,"b");return arr[n]==="a";}());defineProperties(ArrayPrototype,{splice:function splice(start,deleteCount){var O=ES.ToObject(this);var A=[];var len=ES.ToUint32(O.length);var relativeStart=ES.ToInteger(start);var actualStart=relativeStart<0?max((len+relativeStart),0):min(relativeStart,len);var actualDeleteCount=min(max(ES.ToInteger(deleteCount),0),len-actualStart);var k=0;var from;while(k<actualDeleteCount){from=$String(actualStart+k);if(owns(O,from)){A[k]=O[from];}k+=1;}var items=arraySlice(arguments,2);var itemCount=items.length;var to;if(itemCount<actualDeleteCount){k=actualStart;var maxK=len-actualDeleteCount;while(k<maxK){from=$String(k+actualDeleteCount);to=$String(k+itemCount);if(owns(O,from)){O[to]=O[from];}else{delete O[to];}k+=1;}k=len;var minK=len-actualDeleteCount+itemCount;while(k>minK){delete O[k-1];k-=1;}}else{if(itemCount>actualDeleteCount){k=len-actualDeleteCount;while(k>actualStart){from=$String(k+actualDeleteCount-1);to=$String(k+itemCount-1);if(owns(O,from)){O[to]=O[from];}else{delete O[to];}k-=1;}}}k=actualStart;for(var i=0;i<items.length;++i){O[k]=items[i];k+=1;}O.length=len-actualDeleteCount+itemCount;return A;}},!spliceWorksWithLargeSparseArrays||!spliceWorksWithSmallSparseArrays);var originalJoin=ArrayPrototype.join;var hasStringJoinBug;try{hasStringJoinBug=Array.prototype.join.call("123",",")!=="1,2,3";}catch(e){hasStringJoinBug=true;}if(hasStringJoinBug){defineProperties(ArrayPrototype,{join:function join(separator){var sep=typeof separator==="undefined"?",":separator;return originalJoin.call(isString(this)?strSplit(this,""):this,sep);}},hasStringJoinBug);}var hasJoinUndefinedBug=[1,2].join(undefined)!=="1,2";if(hasJoinUndefinedBug){defineProperties(ArrayPrototype,{join:function join(separator){var sep=typeof separator==="undefined"?",":separator;return originalJoin.call(this,sep);}},hasJoinUndefinedBug);}var pushShim=function push(item){var O=ES.ToObject(this);var n=ES.ToUint32(O.length);var i=0;while(i<arguments.length){O[n+i]=arguments[i];i+=1;}O.length=n+i;return n+i;};var pushIsNotGeneric=(function(){var obj={};var result=Array.prototype.push.call(obj,undefined);return result!==1||obj.length!==1||typeof obj[0]!=="undefined"||!owns(obj,0);}());defineProperties(ArrayPrototype,{push:function push(item){if(isArray(this)){return array_push.apply(this,arguments);}return pushShim.apply(this,arguments);}},pushIsNotGeneric);var pushUndefinedIsWeird=(function(){var arr=[];var result=arr.push(undefined);return result!==1||arr.length!==1||typeof arr[0]!=="undefined"||!owns(arr,0);}());defineProperties(ArrayPrototype,{push:pushShim},pushUndefinedIsWeird);defineProperties(ArrayPrototype,{slice:function(start,end){var arr=isString(this)?strSplit(this,""):this;return arraySliceApply(arr,arguments);}},splitString);var sortIgnoresNonFunctions=(function(){try{[1,2].sort(null);[1,2].sort({});return true;}catch(e){}return false;}());var sortThrowsOnRegex=(function(){try{[1,2].sort(/a/);return false;}catch(e){}return true;}());var sortIgnoresUndefined=(function(){try{[1,2].sort(undefined);return true;}catch(e){}return false;}());defineProperties(ArrayPrototype,{sort:function sort(compareFn){if(typeof compareFn==="undefined"){return arraySort(this);}if(!isCallable(compareFn)){throw new TypeError("Array.prototype.sort callback must be a function");}return arraySort(this,compareFn);}},sortIgnoresNonFunctions||!sortIgnoresUndefined||!sortThrowsOnRegex);var hasDontEnumBug=!isEnum({toString:null},"toString");var hasProtoEnumBug=isEnum(function(){},"prototype");var hasStringEnumBug=!owns("x","0");var equalsConstructorPrototype=function(o){var ctor=o.constructor;return ctor&&ctor.prototype===o;};var excludedKeys={$window:true,$console:true,$parent:true,$self:true,$frame:true,$frames:true,$frameElement:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$external:true,$width:true,$height:true};var hasAutomationEqualityBug=(function(){if(typeof window==="undefined"){return false;}for(var k in window){try{if(!excludedKeys["$"+k]&&owns(window,k)&&window[k]!==null&&typeof window[k]==="object"){equalsConstructorPrototype(window[k]);}}catch(e){return true;}}return false;}());var equalsConstructorPrototypeIfNotBuggy=function(object){if(typeof window==="undefined"||!hasAutomationEqualityBug){return equalsConstructorPrototype(object);}try{return equalsConstructorPrototype(object);}catch(e){return false;}};var dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var dontEnumsLength=dontEnums.length;var isStandardArguments=function isArguments(value){return toStr(value)==="[object Arguments]";};var isLegacyArguments=function isArguments(value){return value!==null&&typeof value==="object"&&typeof value.length==="number"&&value.length>=0&&!isArray(value)&&isCallable(value.callee);};var isArguments=isStandardArguments(arguments)?isStandardArguments:isLegacyArguments;defineProperties($Object,{keys:function keys(object){var isFn=isCallable(object);var isArgs=isArguments(object);var isObject=object!==null&&typeof object==="object";var isStr=isObject&&isString(object);if(!isObject&&!isFn&&!isArgs){throw new TypeError("Object.keys called on a non-object");}var theKeys=[];var skipProto=hasProtoEnumBug&&isFn;if((isStr&&hasStringEnumBug)||isArgs){for(var i=0;i<object.length;++i){pushCall(theKeys,$String(i));}}if(!isArgs){for(var name in object){if(!(skipProto&&name==="prototype")&&owns(object,name)){pushCall(theKeys,$String(name));}}}if(hasDontEnumBug){var skipConstructor=equalsConstructorPrototypeIfNotBuggy(object);for(var j=0;j<dontEnumsLength;j++){var dontEnum=dontEnums[j];if(!(skipConstructor&&dontEnum==="constructor")&&owns(object,dontEnum)){pushCall(theKeys,dontEnum);}}}return theKeys;}});var keysWorksWithArguments=$Object.keys&&(function(){return $Object.keys(arguments).length===2;}(1,2));var keysHasArgumentsLengthBug=$Object.keys&&(function(){var argKeys=$Object.keys(arguments);return arguments.length!==1||argKeys.length!==1||argKeys[0]!==1;}(1));var originalKeys=$Object.keys;defineProperties($Object,{keys:function keys(object){if(isArguments(object)){return originalKeys(arraySlice(object));}else{return originalKeys(object);}}},!keysWorksWithArguments||keysHasArgumentsLengthBug);var hasNegativeMonthYearBug=new Date(-3509827329600292).getUTCMonth()!==0;var aNegativeTestDate=new Date(-1509842289600292);var aPositiveTestDate=new Date(1449662400000);var hasToUTCStringFormatBug=aNegativeTestDate.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var hasToDateStringFormatBug;var hasToStringFormatBug;var timeZoneOffset=aNegativeTestDate.getTimezoneOffset();if(timeZoneOffset<-720){hasToDateStringFormatBug=aNegativeTestDate.toDateString()!=="Tue Jan 02 -45875";hasToStringFormatBug=!(/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/).test(aPositiveTestDate.toString());}else{hasToDateStringFormatBug=aNegativeTestDate.toDateString()!=="Mon Jan 01 -45875";hasToStringFormatBug=!(/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/).test(aPositiveTestDate.toString());}var originalGetFullYear=call.bind(Date.prototype.getFullYear);var originalGetMonth=call.bind(Date.prototype.getMonth);var originalGetDate=call.bind(Date.prototype.getDate);var originalGetHours=call.bind(Date.prototype.getHours);var originalGetMinutes=call.bind(Date.prototype.getMinutes);var originalGetSeconds=call.bind(Date.prototype.getSeconds);var originalGetMilliseconds=call.bind(Date.prototype.getMilliseconds);var originalGetUTCFullYear=call.bind(Date.prototype.getUTCFullYear);var originalGetUTCMonth=call.bind(Date.prototype.getUTCMonth);var originalGetUTCDate=call.bind(Date.prototype.getUTCDate);var originalGetUTCDay=call.bind(Date.prototype.getUTCDay);var originalGetUTCHours=call.bind(Date.prototype.getUTCHours);var originalGetUTCMinutes=call.bind(Date.prototype.getUTCMinutes);var originalGetUTCSeconds=call.bind(Date.prototype.getUTCSeconds);var originalGetUTCMilliseconds=call.bind(Date.prototype.getUTCMilliseconds);var dayName=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var monthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var daysInMonth=function daysInMonth(month,year){return originalGetDate(new Date(year,month,0));};defineProperties(Date.prototype,{getHours:Date.prototype.getHours,getMinutes:Date.prototype.getMinutes,getSeconds:Date.prototype.getSeconds,getMilliseconds:Date.prototype.getMilliseconds},true);defineProperties(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetFullYear(this);if(year<0&&originalGetMonth(this)>11){return year+1;}return year;},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetFullYear(this);var month=originalGetMonth(this);if(year<0&&month>11){return 0;}return month;},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetFullYear(this);var month=originalGetMonth(this);var date=originalGetDate(this);if(year<0&&month>11){if(month===12){return date;}var days=daysInMonth(0,year+1);return(days-date)+1;}return date;},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetUTCFullYear(this);if(year<0&&originalGetUTCMonth(this)>11){return year+1;}return year;},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetUTCFullYear(this);var month=originalGetUTCMonth(this);if(year<0&&month>11){return 0;}return month;},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var year=originalGetUTCFullYear(this);var month=originalGetUTCMonth(this);var date=originalGetUTCDate(this);if(year<0&&month>11){if(month===12){return date;}var days=daysInMonth(0,year+1);return(days-date)+1;}return date;}},hasNegativeMonthYearBug);defineProperties(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var day=originalGetUTCDay(this);var date=originalGetUTCDate(this);var month=originalGetUTCMonth(this);var year=originalGetUTCFullYear(this);var hour=originalGetUTCHours(this);var minute=originalGetUTCMinutes(this);var second=originalGetUTCSeconds(this);return dayName[day]+", "+(date<10?"0"+date:date)+" "+monthName[month]+" "+year+" "+(hour<10?"0"+hour:hour)+":"+(minute<10?"0"+minute:minute)+":"+(second<10?"0"+second:second)+" GMT";}},hasNegativeMonthYearBug||hasToUTCStringFormatBug);defineProperties(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var day=this.getDay();var date=this.getDate();var month=this.getMonth();var year=this.getFullYear();return dayName[day]+" "+monthName[month]+" "+(date<10?"0"+date:date)+" "+year;}},hasNegativeMonthYearBug||hasToDateStringFormatBug);if(hasNegativeMonthYearBug||hasToStringFormatBug){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.");}var day=this.getDay();var date=this.getDate();var month=this.getMonth();var year=this.getFullYear();var hour=this.getHours();var minute=this.getMinutes();var second=this.getSeconds();var timezoneOffset=this.getTimezoneOffset();var hoursOffset=Math.floor(Math.abs(timezoneOffset)/60);var minutesOffset=Math.floor(Math.abs(timezoneOffset)%60);return dayName[day]+" "+monthName[month]+" "+(date<10?"0"+date:date)+" "+year+" "+(hour<10?"0"+hour:hour)+":"+(minute<10?"0"+minute:minute)+":"+(second<10?"0"+second:second)+" GMT"+(timezoneOffset>0?"-":"+")+(hoursOffset<10?"0"+hoursOffset:hoursOffset)+(minutesOffset<10?"0"+minutesOffset:minutesOffset);};if(supportsDescriptors){$Object.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true});}}var negativeDate=-62198755200000;var negativeYearString="-000001";var hasNegativeDateBug=Date.prototype.toISOString&&new Date(negativeDate).toISOString().indexOf(negativeYearString)===-1;var hasSafari51DateBug=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var getTime=call.bind(Date.prototype.getTime);defineProperties(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(getTime(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.");}var year=originalGetUTCFullYear(this);var month=originalGetUTCMonth(this);year+=Math.floor(month/12);month=((month%12)+12)%12;var result=[month+1,originalGetUTCDate(this),originalGetUTCHours(this),originalGetUTCMinutes(this),originalGetUTCSeconds(this)];year=((year<0?"-":(year>9999?"+":""))+strSlice("00000"+Math.abs(year),(0<=year&&year<=9999)?-4:-6));for(var i=0;i<result.length;++i){result[i]=strSlice("00"+result[i],-2);}return(year+"-"+arraySlice(result,0,2).join("-")+"T"+arraySlice(result,2).join(":")+"."+strSlice("000"+originalGetUTCMilliseconds(this),-3)+"Z");}},hasNegativeDateBug||hasSafari51DateBug);var dateToJSONIsSupported=(function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(negativeDate).toJSON().indexOf(negativeYearString)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true;}});}catch(e){return false;}}());if(!dateToJSONIsSupported){Date.prototype.toJSON=function toJSON(key){var O=$Object(this);var tv=ES.ToPrimitive(O);if(typeof tv==="number"&&!isFinite(tv)){return null;}var toISO=O.toISOString;if(!isCallable(toISO)){throw new TypeError("toISOString property is not callable");}return toISO.call(O);};}var supportsExtendedYears=Date.parse("+033658-09-27T01:46:40.000Z")===1000000000000000;var acceptsInvalidDates=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var doesNotParseY2KNewYear=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(doesNotParseY2KNewYear||acceptsInvalidDates||!supportsExtendedYears){var maxSafeUnsigned32Bit=Math.pow(2,31)-1;var hasSafariSignedIntBug=isActualNaN(new Date(1970,0,1,0,0,0,maxSafeUnsigned32Bit+1).getTime());Date=(function(NativeDate){var DateShim=function Date(Y,M,D,h,m,s,ms){var length=arguments.length;var date;if(this instanceof NativeDate){var seconds=s;var millis=ms;if(hasSafariSignedIntBug&&length>=7&&ms>maxSafeUnsigned32Bit){var msToShift=Math.floor(ms/maxSafeUnsigned32Bit)*maxSafeUnsigned32Bit;var sToShift=Math.floor(msToShift/1000);seconds+=sToShift;millis-=sToShift*1000;}date=length===1&&$String(Y)===Y?new NativeDate(DateShim.parse(Y)):length>=7?new NativeDate(Y,M,D,h,m,seconds,millis):length>=6?new NativeDate(Y,M,D,h,m,seconds):length>=5?new NativeDate(Y,M,D,h,m):length>=4?new NativeDate(Y,M,D,h):length>=3?new NativeDate(Y,M,D):length>=2?new NativeDate(Y,M):length>=1?new NativeDate(Y instanceof NativeDate?+Y:Y):new NativeDate();}else{date=NativeDate.apply(this,arguments);}if(!isPrimitive(date)){defineProperties(date,{constructor:DateShim},true);}return date;};var isoDateExpression=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$");var months=[0,31,59,90,120,151,181,212,243,273,304,334,365];var dayFromMonth=function dayFromMonth(year,month){var t=month>1?1:0;return(months[month]+Math.floor((year-1969+t)/4)-Math.floor((year-1901+t)/100)+Math.floor((year-1601+t)/400)+(365*(year-1970)));};var toUTC=function toUTC(t){var s=0;var ms=t;if(hasSafariSignedIntBug&&ms>maxSafeUnsigned32Bit){var msToShift=Math.floor(ms/maxSafeUnsigned32Bit)*maxSafeUnsigned32Bit;var sToShift=Math.floor(msToShift/1000);s+=sToShift;ms-=sToShift*1000;}return $Number(new NativeDate(1970,0,1,0,0,s,ms));};for(var key in NativeDate){if(owns(NativeDate,key)){DateShim[key]=NativeDate[key];}}defineProperties(DateShim,{now:NativeDate.now,UTC:NativeDate.UTC},true);DateShim.prototype=NativeDate.prototype;defineProperties(DateShim.prototype,{constructor:DateShim},true);var parseShim=function parse(string){var match=isoDateExpression.exec(string);if(match){var year=$Number(match[1]),month=$Number(match[2]||1)-1,day=$Number(match[3]||1)-1,hour=$Number(match[4]||0),minute=$Number(match[5]||0),second=$Number(match[6]||0),millisecond=Math.floor($Number(match[7]||0)*1000),isLocalTime=Boolean(match[4]&&!match[8]),signOffset=match[9]==="-"?1:-1,hourOffset=$Number(match[10]||0),minuteOffset=$Number(match[11]||0),result;var hasMinutesOrSecondsOrMilliseconds=minute>0||second>0||millisecond>0;if(hour<(hasMinutesOrSecondsOrMilliseconds?24:25)&&minute<60&&second<60&&millisecond<1000&&month>-1&&month<12&&hourOffset<24&&minuteOffset<60&&day>-1&&day<(dayFromMonth(year,month+1)-dayFromMonth(year,month))){result=(((dayFromMonth(year,month)+day)*24)+hour+(hourOffset*signOffset))*60;result=((((result+minute+(minuteOffset*signOffset))*60)+second)*1000)+millisecond;if(isLocalTime){result=toUTC(result);}if(-8640000000000000<=result&&result<=8640000000000000){return result;}}return NaN;}return NativeDate.parse.apply(this,arguments);};defineProperties(DateShim,{parse:parseShim});return DateShim;}(Date));}if(!Date.now){Date.now=function now(){return new Date().getTime();};}var hasToFixedBugs=NumberPrototype.toFixed&&((0.00008).toFixed(3)!=="0.000"||(0.9).toFixed(0)!=="1"||(1.255).toFixed(2)!=="1.25"||(1000000000000000100).toFixed(0)!=="1000000000000000128");var toFixedHelpers={base:10000000,size:6,data:[0,0,0,0,0,0],multiply:function multiply(n,c){var i=-1;var c2=c;while(++i<toFixedHelpers.size){c2+=n*toFixedHelpers.data[i];toFixedHelpers.data[i]=c2%toFixedHelpers.base;c2=Math.floor(c2/toFixedHelpers.base);}},divide:function divide(n){var i=toFixedHelpers.size;var c=0;while(--i>=0){c+=toFixedHelpers.data[i];toFixedHelpers.data[i]=Math.floor(c/n);c=(c%n)*toFixedHelpers.base;}},numToString:function numToString(){var i=toFixedHelpers.size;var s="";while(--i>=0){if(s!==""||i===0||toFixedHelpers.data[i]!==0){var t=$String(toFixedHelpers.data[i]);if(s===""){s=t;}else{s+=strSlice("0000000",0,7-t.length)+t;}}}return s;},pow:function pow(x,n,acc){return(n===0?acc:(n%2===1?pow(x,n-1,acc*x):pow(x*x,n/2,acc)));},log:function log(x){var n=0;var x2=x;while(x2>=4096){n+=12;x2/=4096;}while(x2>=2){n+=1;x2/=2;}return n;}};var toFixedShim=function toFixed(fractionDigits){var f,x,s,m,e,z,j,k;f=$Number(fractionDigits);f=isActualNaN(f)?0:Math.floor(f);if(f<0||f>20){throw new RangeError("Number.toFixed called with invalid number of decimals");}x=$Number(this);if(isActualNaN(x)){return"NaN";}if(x<=-1e+21||x>=1e+21){return $String(x);}s="";if(x<0){s="-";x=-x;}m="0";if(x>1e-21){e=toFixedHelpers.log(x*toFixedHelpers.pow(2,69,1))-69;z=(e<0?x*toFixedHelpers.pow(2,-e,1):x/toFixedHelpers.pow(2,e,1));z*=4503599627370496;e=52-e;if(e>0){toFixedHelpers.multiply(0,z);j=f;while(j>=7){toFixedHelpers.multiply(10000000,0);j-=7;}toFixedHelpers.multiply(toFixedHelpers.pow(10,j,1),0);j=e-1;while(j>=23){toFixedHelpers.divide(1<<23);j-=23;}toFixedHelpers.divide(1<<j);toFixedHelpers.multiply(1,1);toFixedHelpers.divide(2);m=toFixedHelpers.numToString();}else{toFixedHelpers.multiply(0,z);toFixedHelpers.multiply(1<<(-e),0);m=toFixedHelpers.numToString()+strSlice("0.00000000000000000000",2,2+f);}}if(f>0){k=m.length;if(k<=f){m=s+strSlice("0.0000000000000000000",0,f-k+2)+m;}else{m=s+strSlice(m,0,k-f)+"."+strSlice(m,k-f);}}else{m=s+m;}return m;};defineProperties(NumberPrototype,{toFixed:toFixedShim},hasToFixedBugs);var hasToPrecisionUndefinedBug=(function(){try{return Number("1.0").toPrecision(undefined)==="1";}catch(e){return true;}}());var originalToPrecision=NumberPrototype.toPrecision;defineProperties(NumberPrototype,{toPrecision:function toPrecision(precision){return typeof precision==="undefined"?originalToPrecision.call(this):originalToPrecision.call(this,precision);}},hasToPrecisionUndefinedBug);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var compliantExecNpcg=typeof(/()??/).exec("")[1]==="undefined";var maxSafe32BitInt=Math.pow(2,32)-1;StringPrototype.split=function(separator,limit){var string=String(this);if(typeof separator==="undefined"&&limit===0){return[];}if(!isRegex(separator)){return strSplit(this,separator,limit);}var output=[];var flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":""),lastLastIndex=0,separator2,match,lastIndex,lastLength;var separatorCopy=new RegExp(separator.source,flags+"g");if(!compliantExecNpcg){separator2=new RegExp("^"+separatorCopy.source+"$(?!\\s)",flags);}var splitLimit=typeof limit==="undefined"?maxSafe32BitInt:ES.ToUint32(limit);match=separatorCopy.exec(string);while(match){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){pushCall(output,strSlice(string,lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(typeof arguments[i]==="undefined"){match[i]=void 0;}}});}if(match.length>1&&match.index<string.length){array_push.apply(output,arraySlice(match,1));}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=splitLimit){break;}}if(separatorCopy.lastIndex===match.index){separatorCopy.lastIndex++;}match=separatorCopy.exec(string);}if(lastLastIndex===string.length){if(lastLength||!separatorCopy.test("")){pushCall(output,"");}}else{pushCall(output,strSlice(string,lastLastIndex));}return output.length>splitLimit?arraySlice(output,0,splitLimit):output;};}());}else{if("0".split(void 0,0).length){StringPrototype.split=function split(separator,limit){if(typeof separator==="undefined"&&limit===0){return[];}return strSplit(this,separator,limit);};}}var str_replace=StringPrototype.replace;var replaceReportsGroupsCorrectly=(function(){var groups=[];"x".replace(/x(.)?/g,function(match,group){pushCall(groups,group);});return groups.length===1&&typeof groups[0]==="undefined";}());if(!replaceReportsGroupsCorrectly){StringPrototype.replace=function replace(searchValue,replaceValue){var isFn=isCallable(replaceValue);var hasCapturingGroups=isRegex(searchValue)&&(/\)[*?]/).test(searchValue.source);if(!isFn||!hasCapturingGroups){return str_replace.call(this,searchValue,replaceValue);}else{var wrappedReplaceValue=function(match){var length=arguments.length;var originalLastIndex=searchValue.lastIndex;searchValue.lastIndex=0;var args=searchValue.exec(match)||[];searchValue.lastIndex=originalLastIndex;pushCall(args,arguments[length-2],arguments[length-1]);return replaceValue.apply(this,args);};return str_replace.call(this,searchValue,wrappedReplaceValue);}};}var string_substr=StringPrototype.substr;var hasNegativeSubstrBug="".substr&&"0b".substr(-1)!=="b";defineProperties(StringPrototype,{substr:function substr(start,length){var normalizedStart=start;if(start<0){normalizedStart=max(this.length+start,0);}return string_substr.call(this,normalizedStart,length);}},hasNegativeSubstrBug);var ws="\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF";var zeroWidth="\u200b";var wsRegexChars="["+ws+"]";var trimBeginRegexp=new RegExp("^"+wsRegexChars+wsRegexChars+"*");var trimEndRegexp=new RegExp(wsRegexChars+wsRegexChars+"*$");var hasTrimWhitespaceBug=StringPrototype.trim&&(ws.trim()||!zeroWidth.trim());defineProperties(StringPrototype,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object");}return $String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"");}},hasTrimWhitespaceBug);var trim=call.bind(String.prototype.trim);var hasLastIndexBug=StringPrototype.lastIndexOf&&"abcあい".lastIndexOf("あい",2)!==-1;defineProperties(StringPrototype,{lastIndexOf:function lastIndexOf(searchString){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object");}var S=$String(this);var searchStr=$String(searchString);var numPos=arguments.length>1?$Number(arguments[1]):NaN;var pos=isActualNaN(numPos)?Infinity:ES.ToInteger(numPos);var start=min(max(pos,0),S.length);var searchLen=searchStr.length;var k=start+searchLen;while(k>0){k=max(0,k-searchLen);var index=strIndexOf(strSlice(S,k,start+searchLen),searchStr);if(index!==-1){return k+index;}}return -1;}},hasLastIndexBug);var originalLastIndexOf=StringPrototype.lastIndexOf;defineProperties(StringPrototype,{lastIndexOf:function lastIndexOf(searchString){return originalLastIndexOf.apply(this,arguments);}},StringPrototype.lastIndexOf.length!==1);if(parseInt(ws+"08")!==8||parseInt(ws+"0x16")!==22){parseInt=(function(origParseInt){var hexRegex=/^[\-+]?0[xX]/;return function parseInt(str,radix){var string=trim(String(str));var defaultedRadix=$Number(radix)||(hexRegex.test(string)?16:10);return origParseInt(string,defaultedRadix);};}(parseInt));}if(1/parseFloat("-0")!==-Infinity){parseFloat=(function(origParseFloat){return function parseFloat(string){var inputString=trim(String(string));var result=origParseFloat(inputString);return result===0&&strSlice(inputString,0,1)==="-"?-0:result;};}(parseFloat));}if(String(new RangeError("test"))!=="RangeError: test"){var errorToStringShim=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object");}var name=this.name;if(typeof name==="undefined"){name="Error";}else{if(typeof name!=="string"){name=$String(name);}}var msg=this.message;if(typeof msg==="undefined"){msg="";}else{if(typeof msg!=="string"){msg=$String(msg);}}if(!name){return msg;}if(!msg){return name;}return name+": "+msg;};Error.prototype.toString=errorToStringShim;}if(supportsDescriptors){var ensureNonEnumerable=function(obj,prop){if(isEnum(obj,prop)){var desc=Object.getOwnPropertyDescriptor(obj,prop);if(desc.configurable){desc.enumerable=false;Object.defineProperty(obj,prop,desc);}}};ensureNonEnumerable(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message="";}ensureNonEnumerable(Error.prototype,"name");}if(String(/a/mig)!=="/a/gim"){var regexToString=function toString(){var str="/"+this.source+"/";if(this.global){str+="g";}if(this.ignoreCase){str+="i";}if(this.multiline){str+="m";}return str;};RegExp.prototype.toString=regexToString;}}));if($&&$.global){if(typeof Log!=="function"){Log=function Log(){};Log.log=Log.info=Log.warn=Log.error=function(logIn){$.writeln(logIn);};}if(typeof $.global.log=="undefined"){$.global.log=Log;}if(typeof $.global.console=="undefined"){$.global.console=Log;}}if(!String.prototype.repeat){String.prototype.repeat=function(count){if(this==null){throw new TypeError("can't convert "+this+" to object");}var str=""+this;count=+count;if(count<0){throw new RangeError("repeat count must be non-negative");}if(count==Infinity){throw new RangeError("repeat count must be less than infinity");}count|=0;if(str.length==0||count==0){return"";}if(str.length*count>=(1<<28)){throw new RangeError("repeat count must not overflow maximum string size");}while(count>>=1){str+=str;}str+=str.substring(0,str.length*count-str.length);return str;};}if(!String.prototype.padStart){String.prototype.padStart=function padStart(targetLength,padString){targetLength=targetLength>>0;padString=String(typeof padString!=="undefined"?padString:" ");if(this.length>=targetLength){return String(this);}else{targetLength=targetLength-this.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}return padString.slice(0,targetLength)+String(this);}};}if(!String.prototype.padEnd){String.prototype.padEnd=function padEnd(targetLength,padString){targetLength=targetLength>>0;padString=String((typeof padString!=="undefined"?padString:" "));if(this.length>targetLength){return String(this);}else{targetLength=targetLength-this.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}return String(this)+padString.slice(0,targetLength);}};}if(typeof JSON!=="object"){JSON={};}(function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n;}function this_value(){return this.valueOf();}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value;}var gap,indent,meta,rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(k!=="this"){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_LogFile=factory;}}}($.global,function(root,logType){$.strict=true;$.writeln("Making extendscript LogFile...");var LogFile={};function _createLogFile(typeString){var logFileDir=new Folder(_getDirString());if(!logFileDir.exists){logFileDir.create();}var logFileName=_getISODate()+"-"+typeString+".log";var logFilePath=_getDirString()+logFileName;return new File(logFilePath);}function _removeLogFiles(keepLatest){var typeString=_getTypeString();var removeTime=(LogFile.file instanceof File&&LogFile.file.exists)?LogFile.file.created.getTime():new Date().getTime();var logFileDir=new Folder(_getDirString());if(logFileDir.exists){var logFiles=logFileDir.getFiles();for(f=0;f<logFiles.length;f++){var myFile=logFiles[f];var fileTime=myFile.created.getTime();var nameSearch=myFile.name.search(typeString+".log");if((fileTime<removeTime||keepLatest==false)&&nameSearch>-1){myFile.remove();}}}}function _getTypeString(){return LogFile.type||"default";}function _getDirString(){return(File($.fileName).exists)?File($.fileName).path+"/logs/":Folder.desktop+"/ExtendScript_Log_UnsavedScripts/";}function _getISODate(){var myDate=new Date();if(typeof myDate.getFullYear!=="function"){myDate.getFullYear=function(){return(myDate.getYear+1900);};}var myYear=myDate.getFullYear().toString();var myMonth=_zeroPad(myDate.getMonth()+1,2);var myDay=_zeroPad(myDate.getDate(),2);var myHours=_zeroPad(myDate.getHours(),2);var myMinutes=_zeroPad(myDate.getMinutes(),2);var mySeconds=_zeroPad(myDate.getSeconds(),2);return myYear+"-"+myMonth+"-"+myDay+"_"+myHours+myMinutes+mySeconds;}function _zeroPad(num,numZeros){var absNum=Math.abs(num);var zeros=Math.max(0,numZeros-Math.floor(absNum).toString().length);var zeroString=Math.pow(10,zeros).toString().substr(1);if(num<0){zeroString="-"+zeroString;}return zeroString+absNum;}LogFile.init=function(logType){LogFile.type=logType;LogFile.directory=_getDirString();LogFile.file=_createLogFile(_getTypeString());return LogFile;};LogFile.writeln=LogFile.log=function(logMessage){LogFile.file.open("a+");LogFile.file.writeln(new Date()+": "+logMessage);LogFile.file.close();return LogFile;};LogFile.clear=LogFile.log=function(logMessage){LogFile.file.open("w");LogFile.file.close();return LogFile;};LogFile.remove=function(){if(File(LogFile.file).exists){LogFile.file.remove();}return LogFile;},LogFile.removeOld=function(){_removeLogFiles();return LogFile;},LogFile.removeAll=function(){_removeLogFiles(false);return LogFile;};return LogFile.init(logType);}));(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_Log=factory;}}}($.global,function(root,logName,logLevel,useLogFile,keepOldLogs){$.strict=true;$.writeln("Making extendscript Log...");var Log={};Log.level=0;Log.logFile=null;Log.levels={};Log.type="";try{var _xLib=new ExternalObject("lib:PlugPlugExternalObject");}catch(err){$.writeln("[ERROR] Could not create ExternalObject for event handling. No CEP support.");}_getExceptionMessage=function _getExceptionMessage(e){var fname,str;fname=!e.fileName?"???":decodeURI(e.fileName);str="\tMessage: "+e.message+"\n\tFile: "+fname+"\n\tLine: "+(e.line||"???")+"\n\tError Name: "+e.name+"\n\tError Number: "+e.number;if($.stack){str+="\t"+$.stack;}return str;};_stringifyMessage=function _stringifyMessage(message){if(typeof message==="string"){return message;}try{return JSON.stringify(message);}catch(e){return message.toString();}};Log.init=function(logName,logLevel,useLogFile,keepOldLogs){Log.level=(typeof logLevel=="number")?logLevel:0;Log.type=(typeof logName=="string")?logName.toLowerCase():"";if(useLogFile&&typeof ExtendScript_LogFile=="function"){if(!Log.logFile){Log.logFile=new ExtendScript_LogFile(Log,logName);if(!keepOldLogs){Log.logFile.removeOld();}}}return Log;};Log.log=function log(message,level,label,useAlert){var file;level=level||2;var prefix=(typeof label=="string"&&label.length)?"["+label.toLowerCase()+"] ":"";if(typeof message!=="string"){message=_stringifyMessage(message);}if(level<Log.level){return;}if($){if(Log.type.length){$.writeln(Log.type.toLowerCase()+":"+prefix+message);}else{$.writeln(prefix+message);}}if(typeof _xLib!=="undefined"){if(typeof label!=="string"||!label.length){label="log";}var eventObj=new CSXSEvent();eventObj.type="ExtendScript_Log";eventObj.data='{"type":"'+Log.type+'","level":"'+level+'","label":"'+label+'","message":"'+message+'"}';eventObj.dispatch();}if(Log.logFile instanceof Object&&Log.logFile.file instanceof File){Log.logFile.writeln(prefix+message);}if(useAlert){alert(message);}return Log;};Log.addLogLevel=function addLogLevel(name,level){name=name.toLowerCase();if(typeof Log.name=="function"&&!Log.levels.name){throw new Error("[ERROR] ExtendScript_Log can not make log level. Name "+name+"is reserved.");}Log.levels[name]=level;Log[name]=function(message,useAlert){if(message instanceof Error){message=_getExceptionMessage(message);}return Log.log(_stringifyMessage(message),level,name,useAlert);};return Log;};Log.removeLogLevel=function removeLogLevel(name){Log.levels[name.toLowerCase()]=undefined;return Log;};Log.clear=function clear(){$.sleep(1000);if(app.name==="ExtendScript Toolkit"){app.clc();}else{var estApp=BridgeTalk.getSpecifier("estoolkit");if(estApp){var bt=new BridgeTalk();bt.target=estApp;bt.body="app.clc()";bt.send();}}if(typeof _xLib!=="undefined"){var eventObj=new CSXSEvent();eventObj.type="ExtendScript_Log";eventObj.data='{"type":"'+Log.type+'","level":99,"label":"clear","message":""}';eventObj.dispatch();}if(Log.logFile instanceof Object&&Log.logFile.file instanceof File){Log.logFile.clear();}return Log;};Log.addLogLevel("critical",5);Log.addLogLevel("error",4);Log.addLogLevel("warn",3);Log.addLogLevel("info",2);Log.addLogLevel("debug",1);Log.addLogLevel("trace",0);if(root){root.log=Log;root.console=Log;}return Log.init(logName,logLevel,useLogFile,keepOldLogs);}));try{log.log;}catch(e){log={};log.log=function(i){$.writeln(i);};}(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_Dialogs=factory;}}}($.global,function(root,overrideNative){$.strict=true;log.log("Making extendscript Dialogs...");var _UICache={};var Dialogs={};var _addMessage=Dialogs.addMessage=function(w,id,message){if(message){w.message=w.add("statictext",undefined,message,{multiline:true});w.message.alignment="fill";w.message.maximumSize=[1000,1000];}return w;};var _addSkippable=Dialogs.addSkippable=function(w,id,skippable){if(skippable){w.cbNoAskAgain=w.add("checkbox",undefined,"Don't ask about this again.");w.cbNoAskAgain.onClick=function(){_UICache[id].skip=w.cbNoAskAgain.value;};}return w;};var _addButtons=Dialogs.addButtons=function(w,id,buttons,onClickFunction){var onClickDefault=function onClickDefault(){_UICache[id].value=Number(this.index);_UICache[id].button=Number(this.index);w.close(_UICache[id].value);};w.buttonGroup=w.add("group");w.buttonGroup.orientation="row";for(btn in buttons){if(!buttons.hasOwnProperty(btn)){continue;}var newButton=w.buttonGroup.add('button {alignment:"fill",justify:"center"}');newButton.text=buttons[btn];newButton.index=btn;newButton.onClick=(typeof onClickFunction=="function")?onClickFunction:onClickDefault;}w.defaultElement=w.buttonGroup.children[(w.buttonGroup.children.length-1)];w.cancelElement=w.buttonGroup.children[0];return w;};Dialogs.getCached=function(id){if(typeof id==="undefined"){id=-1;}return _UICache[id];};Dialogs.clearCached=function(id){if(typeof id==="undefined"){id=-1;}_UICache[id]=undefined;};Dialogs.alert=function alertDialog(args){if(typeof args=="string"){args={text:args};}args.title=args.title||"Alert";args.text=args.text||"Something Happened!";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["OK"];return Dialogs.confirm(args);};Dialogs.confirm=function confirmDialog(args){if(typeof args=="string"){args={text:args};}args.title=args.title||"Confirm";args.text=args.text||"Do you agree?";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);w.minimumSize=[155,50];_addMessage(w,args.id,args.text);_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();return w.show();};Dialogs.prompt=function promptDialog(args,defaultText){function onClickDlgButton(){_UICache[args.id].button=Number(this.index);_UICache[args.id].value=this.window.prompt.text;w.close(Number(this.index));}if(typeof args=="string"){args={text:args,defaultText:defaultText};}args.title=args.title||"Prompt";args.text=args.text||"What is your answer?";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];args.defaultText=args.defaultText||"";args.multiline=args.multiline||false;if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);_addMessage(w,args.id,args.text);if(args.multiline){w.prompt=w.add("edittext",[0,0,150,70],args.defaultText,{multiline:true,wantReturn:true});}else{w.prompt=w.add("edittext",undefined,args.defaultText,{wantReturn:true});}w.prompt.alignment="fill";w.layout.layout();w.prompt.active=true;_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons,onClickDlgButton);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();if(w.show()!==0){return _UICache[args.id].value;}};Dialogs.dropdown=function dropdownDialog(args){function onClickDlgButton(){_UICache[args.id].button=Number(this.index);_UICache[args.id].value=this.window.dropdown.selection.text;w.close(Number(this.index));}if(Object.prototype.toString.call(args)==="[object Array]"){args={menuItems:args};}args.title=args.title||"Choose One";args.text=args.text||"";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];args.menuItems=args.menuItems||["Item1","Item2"];if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);w.minimumSize=[155,50];_addMessage(w,args.id,args.text);w.dropdown=w.add("dropdownlist",undefined,args.menuItems);w.dropdown.selection=0;_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons,onClickDlgButton);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();if(w.show()!==0){return _UICache[args.id].value;}};function alertNative(arg){var args=(typeof arg=="object")?arg:{title:"Alert",id:-1,text:arg,buttons:["OK"]};Dialogs.alert(arg);}function confirmNative(arg){if(typeof arg=="object"){return Dialogs.confirm(arg);}else{return Boolean(Dialogs.confirm({title:"Confirm",id:-1,text:arg,buttons:["Cancel","OK"]}));}}function promptNative(args,defaultText){args=(typeof args=="object")?args:{title:"Prompt",id:-1,text:args,defaultText:defaultText,buttons:["Cancel","OK"]};return Dialogs.prompt(args);}if(root){root.Dialogs=Dialogs;if(root!==$.global){try{root.alert=alertNative;root.confirm=confirmNative;root.prompt=promptNative;}catch(e){log.log("[ERROR] "+e.message);}}}if(overrideNative===true){$.sleep(200);try{$.global.alert=alertNative;$.global.confirm=confirmNative;$.global.prompt=promptNative;}catch(e){log.log("[ERROR] "+e.message);}}return Dialogs;}));$.writeln("Libs for shims, shams, polyfills, and party hats loaded...");}else{console.log("ES5 function [].map() found. Assume we already shim-shammed this party. Not reinitializing dependencies.");}
/*!
 * Libs for shims, shams, polyfills, and party hats loaded...
 */
;
/*!
 * Copyright 2014 Francesco Camarlinghi
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * 	http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
;if(typeof Lifter!=="object"){(function(){$.strict=true;var _DEVBUILD=false;$.writeln("Starting Lifter...");var Lifter=this.Lifter=function Lifter(){};var _dialogModesNo=DialogModes.NO,c2id=charIDToTypeID,s2id=stringIDToTypeID;var _rulerUnitCache=[];try{var _xLib=new ExternalObject("lib:PlugPlugExternalObject");}catch(err){throw new Error(['Could not create ExternalObject for event handling: \n"',err].join(""));}if(_DEVBUILD){Lifter.log=new ExtendScript_Log($.global,0,"Lifter",true,false);}else{Lifter.log=new ExtendScript_Log($.global,4,"Lifter",false);}if(typeof log!=="object"){log=Lifter.log;}Lifter.dialogs=new ExtendScript_Dialogs($.global,true);log.log("LOADING Lifter core ...");var Enumeration=this.Enumeration=function Enumeration(){};Enumeration.fromValue=function(enumeration,value){if(typeof enumeration!=="function"){throw new TypeError(['Invalid enumeration "',enumeration,'".'].join(""));}value=+value||0;var enumKeys=Object.keys(enumeration),enumerator;for(var i=0,n=enumKeys.length;i<n;i++){enumerator=enumeration[enumKeys[i]];if(enumerator.valueOf&&enumerator.valueOf()===value){return enumerator;}}return null;};Enumeration.contains=function(enumeration,value){return Enumeration.fromValue(enumeration,value)!==null;};Enumeration.toArray=function(enumeration){if(typeof enumeration!=="function"){throw new TypeError(['Invalid enumeration "',enumeration,'".'].join(""));}var enumKeys=Object.keys(enumeration),enumKeysLength=enumKeys.length,enumerator,result=[];for(var i=0;i<enumKeysLength;i++){enumerator=enumeration[enumKeys[i]];if(enumerator instanceof Enumerator){result.push(enumerator);}}return result;};var Enumerator=this.Enumerator=function Enumerator(name,value){this.__name=name;this.__value=value;};Enumerator.prototype={toString:function(){return this.__name;},valueOf:function(){return this.__value;},"+":function(operand,rev){return undefined;},"-":function(operand,rev){return undefined;},"*":function(operand,rev){return undefined;},"/":function(operand,rev){return undefined;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()===this.valueOf();},"==":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()==this.valueOf();},"<":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{return this.valueOf()<operand.valueOf();}},"<=":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{if(rev){return this.valueOf()>=operand.valueOf();}else{return this.valueOf()<=operand.valueOf();}}}};var UnitDouble=this.UnitDouble=function UnitDouble(unitType,doubleValue){this.unitType=unitType;this.doubleValue=doubleValue;};UnitDouble.prototype={toString:function(){return this.unitType+" = "+this.doubleValue;},valueOf:function(){return this.doubleValue;},"+":function(operand,rev){return this.doubleValue+operand;},"-":function(operand,rev){return(rev)?operand-this.doubleValue:this.doubleValue-operand;},"*":function(operand,rev){return this.doubleValue*operand;},"/":function(operand,rev){return(rev)?operand/this.doubleValue:this.doubleValue/operand;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()===this.valueOf();},"==":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()==this.valueOf();},"<":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{return this.valueOf()<operand.valueOf();}},"<=":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{if(rev){return this.valueOf()>=operand.valueOf();}else{return this.valueOf()<=operand.valueOf();}}}};var LayerBounds=this.LayerBounds=function LayerBounds(top,left,bottom,right){this.top=new UnitValue(top,"px");this.left=new UnitValue(left,"px");this.bottom=new UnitValue(bottom,"px");this.right=new UnitValue(right,"px");};LayerBounds.prototype={toString:function(){return[this.top,this.left,this.bottom,this.right].join(", ");},valueOf:function(){return undefined;},"+":function(operand,rev){return undefined;},"-":function(operand,rev){return undefined;},"*":function(operand,rev){return undefined;},"/":function(operand,rev){return undefined;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand)?false:(operand.top===this.top&&operand.left===this.left&&operand.bottom===this.bottom&&operand.right===this.right);},"==":function(operand,rev){return operand===this;},"<":function(operand,rev){return undefined;},"<=":function(operand,rev){return undefined;}};var LayerType=this.LayerType=function LayerType(){};LayerType.SETSTART=new Enumerator("LayerType.SETSTART",0);LayerType.SETEND=new Enumerator("LayerType.SETEND",1);LayerType.CONTENT=new Enumerator("LayerType.CONTENT",2);var LayerColor=this.LayerColor=function LayerColor(){};LayerColor.NONE=new Enumerator("LayerColor.NONE",c2id("None"));LayerColor.RED=new Enumerator("LayerColor.RED",c2id("Rd  "));LayerColor.ORANGE=new Enumerator("LayerColor.ORANGE",c2id("Orng"));LayerColor.YELLOW=new Enumerator("LayerColor.YELLOW",c2id("Ylw "));LayerColor.GREEN=new Enumerator("LayerColor.GREEN",c2id("Grn "));LayerColor.BLUE=new Enumerator("LayerColor.BLUE",c2id("Bl  "));LayerColor.VIOLET=new Enumerator("LayerColor.VIOLET",c2id("Vlt "));LayerColor.GRAY=new Enumerator("LayerColor.GRAY",c2id("Gry "));var LifterMaskType=this.LifterMaskType=function LifterMaskType(){};LifterMaskType.TRANSPARENCY=new Enumerator("LifterMaskType.TRANSPARENCY",0);LifterMaskType.LAYERMASK=new Enumerator("LifterMaskType.USERMASK",1);LifterMaskType.VECTORMASK=new Enumerator("LifterMaskType.VECTORMASK",2);var LifterBlendMode=this.LifterBlendMode=function LifterBlendMode(){};LifterBlendMode.PASSTHROUGH=new Enumerator("LifterBlendMode.PASSTHROUGH",s2id("passThrough"));LifterBlendMode.NORMAL=new Enumerator("LifterBlendMode.NORMAL",c2id("Nrml"));LifterBlendMode.DISSOLVE=new Enumerator("LifterBlendMode.DISSOLVE",c2id("Dslv"));LifterBlendMode.DARKEN=new Enumerator("LifterBlendMode.DARKEN",c2id("Drkn"));LifterBlendMode.MULTIPLY=new Enumerator("LifterBlendMode.MULTIPLY",c2id("Mltp"));LifterBlendMode.COLORBURN=new Enumerator("LifterBlendMode.COLORBURN",c2id("CBrn"));LifterBlendMode.LINEARBURN=new Enumerator("LifterBlendMode.LINEARBURN",s2id("linearBurn"));LifterBlendMode.DARKERCOLOR=new Enumerator("LifterBlendMode.DARKERCOLOR",s2id("darkerColor"));LifterBlendMode.LIGHTEN=new Enumerator("LifterBlendMode.LIGHTEN",c2id("Lghn"));LifterBlendMode.SCREEN=new Enumerator("LifterBlendMode.SCREEN",c2id("Scrn"));LifterBlendMode.COLORDODGE=new Enumerator("LifterBlendMode.COLORDODGE",c2id("CDdg"));LifterBlendMode.LINEARDODGE=new Enumerator("LifterBlendMode.LINEARDODGE",s2id("linearDodge"));LifterBlendMode.LIGHTERCOLOR=new Enumerator("LifterBlendMode.LIGHTERCOLOR",s2id("lighterColor"));LifterBlendMode.OVERLAY=new Enumerator("LifterBlendMode.OVERLAY",c2id("Ovrl"));LifterBlendMode.SOFTLIGHT=new Enumerator("LifterBlendMode.SOFTLIGHT",c2id("SftL"));LifterBlendMode.HARDLIGHT=new Enumerator("LifterBlendMode.HARDLIGHT",c2id("HrdL"));LifterBlendMode.VIVIDLIGHT=new Enumerator("LifterBlendMode.VIVIDLIGHT",s2id("vividLight"));LifterBlendMode.LINEARLIGHT=new Enumerator("LifterBlendMode.LINEARLIGHT",s2id("linearLight"));LifterBlendMode.PINLIGHT=new Enumerator("LifterBlendMode.PINLIGHT",s2id("pinLight"));LifterBlendMode.HARDMIX=new Enumerator("LifterBlendMode.HARDMIX",s2id("hardMix"));LifterBlendMode.DIFFERENCE=new Enumerator("LifterBlendMode.DIFFERENCE",c2id("Dfrn"));LifterBlendMode.EXCLUSION=new Enumerator("LifterBlendMode.EXCLUSION",c2id("Xclu"));LifterBlendMode.SUBTRACT=new Enumerator("LifterBlendMode.SUBTRACT",s2id("blendSubtraction"));LifterBlendMode.DIVIDE=new Enumerator("LifterBlendMode.DIVIDE",s2id("blendDivide"));LifterBlendMode.HUE=new Enumerator("LifterBlendMode.HUE",c2id("H   "));LifterBlendMode.SATURATION=new Enumerator("LifterBlendMode.SATURATION",c2id("Strt"));LifterBlendMode.COLOR=new Enumerator("LifterBlendMode.COLOR",c2id("Clr "));LifterBlendMode.LUMINOSITY=new Enumerator("LifterBlendMode.LUMINOSITY",c2id("Lmns"));LifterBlendMode.fromBlendMode=function(blendMode){return LifterBlendMode[String(blendMode).replace(/BlendMode\./,"")];};LifterBlendMode.toBlendMode=function(lifterBlendMode){return eval(lifterBlendMode.toString().replace(/LifterBlendMode/,"BlendMode"));};function _ensureLifterBlendMode(blendMode){if(blendMode instanceof Enumerator){return blendMode;}else{return LifterBlendMode.fromBlendMode(blendMode);}}var ApplyImageChannel=this.ApplyImageChannel=function ApplyImageChannel(){};ApplyImageChannel.RGB=new Enumerator("ApplyImageChannel.RGB",c2id("RGB "));ApplyImageChannel.Red=new Enumerator("ApplyImageChannel.Red",c2id("Rd  "));ApplyImageChannel.Green=new Enumerator("ApplyImageChannel.Green",c2id("Grn "));ApplyImageChannel.Blue=new Enumerator("ApplyImageChannel.Blue",c2id("Bl  "));var setRuler=Lifter.setRuler=function setRuler(units){_rulerUnitCache.push(app.preferences.rulerUnits);app.preferences.rulerUnits=units;};var resetRuler=Lifter.resetRuler=function resetRuler(units){app.preferences.rulerUnits=_rulerUnitCache.pop();};function _getDescriptorProperty(desc,key,type){type||(type=desc.getType(key));switch(type){case DescValueType.ALIASTYPE:return desc.getPath(key);case DescValueType.BOOLEANTYPE:return desc.getBoolean(key);case DescValueType.CLASSTYPE:return desc.getClass(key);case DescValueType.DOUBLETYPE:return desc.getDouble(key);case DescValueType.ENUMERATEDTYPE:return{type:desc.getEnumerationType(key),value:desc.getEnumerationValue(key)};case DescValueType.INTEGERTYPE:return desc.getInteger(key);case DescValueType.LISTTYPE:return desc.getList(key);case DescValueType.OBJECTTYPE:return{type:desc.getObjectType(key),value:desc.getObjectValue(key)};case DescValueType.RAWTYPE:return desc.getData(key);case DescValueType.REFERENCETYPE:return desc.getReference(key);case DescValueType.STRINGTYPE:return desc.getString(key);case DescValueType.UNITDOUBLE:return new UnitDouble(desc.getUnitDoubleType(key),desc.getUnitDoubleValue(key));default:throw new Error(['Unsupported descriptor value type: "',type,'".'].join(""));}}Lifter.getDescPropById=_getDescPropById;function _getDescPropById(desc,tid){try{return _getDescriptorProperty(desc,tid);}catch(e){log.warn('Invalid descriptor property: "'+tid+'".'+e);return;}}Lifter.getDescPropByName=_getDescPropByName;function _getDescPropByName(desc,name){var tid,subProps;var prop=name;var dotTest=name.indexOf(".");if(dotTest!==-1){prop=name.substring(0,dotTest);subProps=name.substring(dotTest+1,name.length);desc=_getDescPropById(desc,s2id(prop)).value;return _getDescPropByName(desc,subProps);}else{return _getDescPropById(desc,s2id(prop));}}function _getWrappedActionDescriptor(desc,props,id){var fn=function(desc,props,id,name,value){if(typeof value==="undefined"){try{return _getDescriptorProperty(desc,s2id(name));}catch(e){log.warn(['Invalid layer property: "',name,'".'].join(""));return;}}else{throw new Error(['Property "',name,'" is read-only.'].join(""));}var prop=props[name];if(typeof value==="undefined"){if(prop.get){return prop.get.call(null,prop,id,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}prop.set.call(null,prop,id,value);}};return{innerDescriptor:desc,prop:fn.bind(null,desc,props,id)};}function _byteToPercent(value){return(value/255)*100;}function _find(collection,findType,patterns,context){function __match(id){for(var j=0;j<keysLength;j++){var matchPattern=patterns[keys[j]];var matchTarget=collection.prop(id,keys[j]);if(patterns[keys[j]]!==collection.prop(id,keys[j])){return false;}}found.push(id);return true;}if(typeof patterns!=="function"){if(typeof patterns!=="object"){throw new Error("Search patterns must be either a function or an object.");}var found=[],keys=Object.keys(patterns),keysLength=keys.length;switch(findType){case 2:collection.forEach(function(itemIndex,id){if(__match.call(null,id)){return true;}},null,true);return found.length?found[0]:null;case 1:collection.forEach(function(itemIndex,id){if(__match.call(null,id)){return true;}},null);return found.length?found[0]:null;default:collection.forEach(function(itemIndex,id){__match.call(null,id);},null);return found;}}else{collection.forEach(patterns,context);}}function _overloadFunction_Number_Bool(arguments,numberDefault,boolDefault){if(typeof arguments[0]==="boolean"){arguments[1]=arguments[0];arguments[0]=undefined;}arguments[0]=isNaN(arguments[0])?numberDefault:arguments[0];if(boolDefault===true){arguments[1]=(arguments[1]!==false);}else{arguments[1]=(arguments[1]===true);}}function _overloadFunction_Number_Obj(arguments,numberDefault,objDefault){if(typeof arguments[0]==="object"){arguments[1]=arguments[0];arguments[0]=undefined;}arguments[0]=isNaN(arguments[0])?numberDefault:arguments[0];if(typeof arguments[1]!=="object"&&typeof objDefault==="object"){arguments[1]=objDefault;}}function _ensureFile(myFile){if(!(myFile instanceof File)){myFile=new File(myFile);}if(!myFile.exists){throw new Error(['The specified file does not exists: "',myFile,'".'].join(""));}return myFile;}function _evalFile(myFile){try{$.evalFile(myFile);}catch(err){throw new Error(['Eval error: "',myFile,'".\n',err].join(""));}}log.log("Lifter core done.");Object.prototype.extend=Object.prototype.extend||function(){if(this===null||typeof this==="undefined"){throw new TypeError("Object.prototype.extend called on null or undefined.");}if(arguments.length===0){return this;}var sources=Array.prototype.slice.call(arguments),source,prop,i,length=sources.length;for(i=0;i<length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)){this[prop]=source[prop];}}}};Object.prototype.defaults=Object.prototype.defaults||function(){if(this===null||typeof this==="undefined"){throw new TypeError("Object.prototype.defaults called on null or undefined.");}if(arguments.length===0){return this;}var sources=Array.prototype.slice.call(arguments),source,prop,i,length=sources.length;for(i=0;i<length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)&&typeof this[prop]==="undefined"){this[prop]=source[prop];}}}};Object.prototype.clone=function(){var copy={};for(var attr in this){if(typeof this[attr]!=="object"){copy[attr]=this[attr];}else{if(this[attr]===this){copy[attr]=copy;}else{copy[attr]=this[attr].clone();}}}return copy;};Array.prototype.clone=function(){var copy=[];for(var i=0,n=this.length;i<n;i++){if(typeof this[i]!=="object"){copy[i]=this[i];}else{if(this[i]===this){copy[i]=copy;}else{copy[i]=this[i].clone();}}}return copy;};Date.prototype.clone=function(){var copy=new Date();copy.setTime(this.getTime());return copy;};Number.prototype.clone=Boolean.prototype.clone=String.prototype.clone=function(){return this;};Number.prototype.pad=function(padCount){var absNum=Math.abs(this);var zeros=Math.max(0,padCount-Math.floor(absNum).toString().length);var zeroString=Math.pow(10,zeros).toString().substr(1);if(this<0){zeroString="-"+zeroString;}return zeroString+absNum;};String.prototype.ellipsis=function ellipsis(maxLength,orientation,ellipsisString){ellipsisString=ellipsisString||"...";if(this.length>maxLength){if(maxLength>ellipsisString.length){switch(orientation){case"start":return ellipsisString+this.slice(-(maxLength-ellipsisString.length));case"center":if(maxLength!=ellipsisString.length+1){return this.slice(0,Math.floor(maxLength/2)-Math.floor(ellipsisString.length/2))+ellipsisString+this.slice(-(Math.ceil(maxLength/2)-Math.ceil(ellipsisString.length/2)),this.length);}case"end":default:return this.slice(0,maxLength-ellipsisString.length)+ellipsisString;}}else{return ellipsisString;}}return this;};(function(){log.log("LOADING Lifter.documents ...");var documents={};var _documentColorModes=[-1,c2id("Grsc"),c2id("RGBC"),c2id("CMYC"),c2id("LbCl"),c2id("Btmp"),c2id("Indl"),c2id("Mlth"),c2id("Dtn ")];function _wrapSwitchActive(documentId,callback,context){documents.list.makeActive(documentId);callback.call(context);}function _getDocumentIdRef(documentId,ref){if(typeof documentId!=="number"){if(documents.count()===0){throw new Error("Could not target current document: no documents are currently open.");}ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(c2id("Dcmn"),documentId);}}documents.supportedProperties={itemIndex:{typeId:c2id("ItmI"),type:DescValueType.INTEGERTYPE,set:false},documentId:{typeId:c2id("DocI"),type:DescValueType.INTEGERTYPE,set:false},width:{typeId:c2id("Wdth"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(64,"px"),get:function(prop,documentId,desc){return new UnitValue(desc.getUnitDoubleValue(prop.typeId),"px");},set:false},height:{typeId:c2id("Hght"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(64,"px"),get:function(prop,documentId,desc){return new UnitValue(desc.getUnitDoubleValue(prop.typeId),"px");},set:false},resolution:{typeId:c2id("Rslt"),type:DescValueType.UNITDOUBLE,defaultValue:72,get:function(prop,documentId,desc){return desc.getUnitDoubleValue(prop.typeId);},set:false},name:{typeId:c2id("Ttl "),type:DescValueType.STRINGTYPE,defaultValue:"Untitled",set:false},bitsPerChannel:{typeId:c2id("Dpth"),type:DescValueType.INTEGERTYPE,defaultValue:BitsPerChannelType.EIGHT,get:function(prop,documentId,desc){var bitsPerChannel=desc.getInteger(prop.typeId);switch(bitsPerChannel){case 1:return BitsPerChannelType.ONE;case 8:return BitsPerChannelType.EIGHT;case 16:return BitsPerChannelType.SIXTEEN;case 32:return BitsPerChannelType.THIRTYTWO;default:throw new Error("Invalid bit depth: "+bitsPerChannel+".");}}},mode:{typeId:c2id("Md  "),type:DescValueType.ENUMERATEDTYPE,defaultValue:DocumentMode.RGB,get:function(prop,documentId,desc){var mode=desc.getEnumerationValue(prop.typeId);switch(mode){case _documentColorModes[1]:return DocumentMode.GRAYSCALE;case _documentColorModes[2]:return DocumentMode.RGB;case _documentColorModes[3]:return DocumentMode.CMYK;case _documentColorModes[4]:return DocumentMode.LAB;case _documentColorModes[5]:return DocumentMode.BITMAP;case _documentColorModes[6]:return DocumentMode.INDEXEDCOLOR;case _documentColorModes[7]:return DocumentMode.MULTICHANNEL;case _documentColorModes[8]:return DocumentMode.DUOTONE;default:throw new Error("Invalid color mode: "+typeIDToCharID(mode)+".");}},set:function(prop,documentId,value){_wrapSwitchActive(documentId,function(){var desc=new ActionDescriptor();if(value===DocumentMode.BITMAP){var desc2=new ActionDescriptor();desc2.putUnitDouble(c2id("Rslt"),c2id("#Rsl"),documents.prop("resolution"));desc2.putEnumerated(c2id("Mthd"),c2id("Mthd"),c2id("DfnD"));desc.putObject(c2id("T   "),c2id("BtmM"),desc2);executeAction(c2id("CnvM"),desc,_dialogModesNo);}else{var mode;switch(value){case DocumentMode.GRAYSCALE:mode=_documentColorModes[1];break;case DocumentMode.RGB:mode=_documentColorModes[2];break;case DocumentMode.CMYK:mode=_documentColorModes[3];break;case DocumentMode.LAB:mode=_documentColorModes[4];break;case DocumentMode.BITMAP:mode=_documentColorModes[5];break;case DocumentMode.INDEXEDCOLOR:mode=_documentColorModes[6];break;case DocumentMode.MULTICHANNEL:mode=_documentColorModes[7];break;case DocumentMode.DUOTONE:mode=_documentColorModes[8];break;default:throw new Error("Invalid color mode: "+value+".");}desc.putClass(c2id("T   "),mode);executeAction(c2id("CnvM"),desc,_dialogModesNo);}});}},colorProfileName:{typeId:s2id("profile"),type:DescValueType.STRINGTYPE,defaultValue:"sRGB IEC61966-2.1",set:function(prop,documentId,value){_wrapSwitchActive(documentId,function(){var ref=new ActionReference();_getDocumentIdRef(documentId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putString(s2id("profile"),value);executeAction(s2id("assignProfile"),desc,_dialogModesNo);});}},format:{typeId:c2id("Fmt "),type:DescValueType.STRINGTYPE,defaultValue:"Photoshop",get:function(prop,documentId,desc){if(!desc.hasKey(prop.typeId)){throw new Error('Unable to get "format". The document needs to be saved before accessing this property.');}return new File(desc.getPath(prop.typeId));},set:false},isDirty:{typeId:c2id("IsDr"),type:DescValueType.BOOLEANTYPE,defaultValue:false,set:false},pixelAspectRatio:{typeId:s2id("pixelScaleFactor"),type:DescValueType.UNITDOUBLE,defaultValue:1,set:false},zoom:{typeId:c2id("Zm  "),type:DescValueType.UNITDOUBLE,defaultValue:1,set:false},xmpMetadata:{typeId:s2id("XMPMetadataAsUTF8"),type:DescValueType.STRINGTYPE,defaultValue:"",get:function(prop,documentId,desc){var data=desc.getString(prop.typeId);return(typeof XMPMeta==="function")?new XMPMeta(data):data;},set:function(prop,documentId,value){if(typeof value.serialize==="function"){value=value.serialize();}_wrapSwitchActive(documentId,function(){app.activeDocument.xmpMetadata.rawData=value;});}},fullName:{typeId:c2id("FilR"),type:DescValueType.ALIASTYPE,defaultValue:null,get:function(prop,documentId,desc){if(!desc.hasKey(prop.typeId)){return null;}else{return new File(desc.getPath(prop.typeId));}},set:false}};documents.count=function(){var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("NmbD"));ref.putEnumerated(c2id("capp"),c2id("Ordn"),c2id("Trgt"));return executeActionGet(ref).getInteger(c2id("NmbD"));};documents.getDocumentIdByItemIndex=function(itemIndex){if(typeof itemIndex!=="number"||itemIndex<1){throw new Error(['Invalid itemIndex: "',itemIndex,'".'].join(""));}var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("DocI"));ref.putIndex(c2id("Dcmn"),itemIndex);return executeActionGet(ref).getInteger(c2id("DocI"));};documents.add=function(width,height,resolution,name,mode,initialFill,pixelAspectRatio,bitsPerChannel,colorProfileName){var desc=new ActionDescriptor();switch(mode){case NewDocumentMode.GRAYSCALE:desc.putClass(c2id("Md  "),c2id("Grys"));break;case NewDocumentMode.CMYK:desc.putClass(c2id("Md  "),c2id("CMYM"));break;case NewDocumentMode.LAB:desc.putClass(c2id("Md  "),c2id("LbCM"));break;case NewDocumentMode.BITMAP:desc.putClass(c2id("Md  "),c2id("BtmM"));break;default:desc.putClass(c2id("Md  "),c2id("RGBM"));break;}if(typeof name==="string"&&name.length){desc.putString(c2id("Nm  "),name);}if((typeof width!=="number"||width<0)&&!(width instanceof UnitValue)){throw new Error("Invalid width: "+width);}desc.putUnitDouble(c2id("Wdth"),c2id("#Pxl"),(width instanceof UnitValue)?width.as("px"):width);if((typeof height!=="number"||height<0)&&!(height instanceof UnitValue)){throw new Error("Invalid height: "+height);}desc.putUnitDouble(c2id("Hght"),c2id("#Pxl"),(height instanceof UnitValue)?height.as("px"):height);desc.putUnitDouble(c2id("Rslt"),c2id("#Rsl"),(typeof resolution==="number"&&resolution>0)?resolution:72);desc.putDouble(s2id("pixelScaleFactor"),(typeof pixelAspectRatio==="number"&&pixelAspectRatio>0)?pixelAspectRatio:1);initialFill||(initialFill=DocumentFill.WHITE);if(initialFill instanceof SolidColor){desc.putEnumerated(c2id("Fl  "),c2id("Fl  "),c2id("Clr "));var desc3=new ActionDescriptor();desc3.putUnitDouble(c2id("H   "),c2id("#Ang"),initialFill.hsb.hue);desc3.putDouble(c2id("Strt"),initialFill.hsb.saturation);desc3.putDouble(c2id("Brgh"),initialFill.hsb.brightness);desc.putObject(c2id("FlCl"),c2id("HSBC"),desc3);}else{switch(initialFill){case DocumentFill.TRANSPARENT:desc.putEnumerated(c2id("Fl  "),c2id("Fl  "),c2id("Trns"));break;case DocumentFill.BACKGROUNDCOLOR:desc.putEnumerated(c2id("Fl  "),c2id("Fl  "),c2id("BckC"));break;default:desc.putEnumerated(c2id("Fl  "),c2id("Fl  "),c2id("Wht "));break;}}switch(bitsPerChannel){case BitsPerChannelType.ONE:desc.putInteger(c2id("Dpth"),1);break;case BitsPerChannelType.SIXTEEN:desc.putInteger(c2id("Dpth"),16);break;case BitsPerChannelType.THIRTYTWO:desc.putInteger(c2id("Dpth"),32);break;default:desc.putInteger(c2id("Dpth"),8);break;}if(typeof colorProfileName==="string"&&colorProfileName.length){desc.putString(s2id("profile"),colorProfileName);}var desc2=new ActionDescriptor();desc2.putObject(c2id("Nw  "),c2id("Dcmn"),desc);executeAction(c2id("Mk  "),desc2,_dialogModesNo);return documents;};documents.open=function(file){var desc=new ActionDescriptor();desc.putPath(c2id("null"),_ensureFile(file));executeAction(c2id("Opn "),desc,_dialogModesNo);return documents;};documents.save=function(saveIn,options,asCopy,extensionType,overwrite){if(documents.count()>0){if(arguments.length===0){app.activeDocument.save();}else{saveIn=_ensureFile(saveIn);if(overwrite===false,saveIn.exists&&documents.prop("fileReference")!==saveIn){throw new Error(['Another file already exists at the specified location: "',saveIn,'".'].join(""));}app.activeDocument.saveAs(_ensureFile(saveIn),options,asCopy,extensionType);}}return documents;};documents.close=function(save){if(documents.count()>0){app.activeDocument.close(!!save?SaveOptions.SAVECHANGES:SaveOptions.DONOTSAVECHANGES);}return documents;};documents.forEach=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;if(reverse){i=documents.count()+1;n=0;while(--i>n){if(callback.call(context,i,documents.getDocumentIdByItemIndex(i))){break;}}}else{n=documents.count()+1;i=0;while(++i<n){if(callback.call(context,i,documents.getDocumentIdByItemIndex(i))){break;}}}return documents;};documents.prop=function(){var documentId,name,value,ref,desc;if(typeof arguments[0]==="number"||(!arguments[0]&&arguments.length>1)){documentId=arguments[0];name=arguments[1];value=arguments[2];}else{name=arguments[0];value=arguments[1];}if(typeof name==="undefined"){ref=new ActionReference();_getDocumentIdRef(documentId,ref);desc=executeActionGet(ref);return _getWrappedActionDescriptor(desc,documents.supportedProperties,documentId||desc.getInteger(c2id("DocI")));}else{if(!documents.supportedProperties.hasOwnProperty(name)){throw new Error(['Invalid document property: "',name,'".'].join(""));}var prop=documents.supportedProperties[name];if(typeof value==="undefined"){ref=new ActionReference();if(prop.typeId){ref.putProperty(c2id("Prpr"),prop.typeId);}_getDocumentIdRef(documentId,ref);desc=executeActionGet(ref);if(prop.get){return prop.get.call(null,prop,documentId,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}prop.set.call(null,prop,documentId,value);return documents;}}};documents.resizeImage=function(width,height,resolution,resampleMethod,scaleStyles){var originalWidth=documents.prop("width");var originalHeight=documents.prop("height");var originalResolution=documents.prop("resolution");if(typeof width==="number"){width=new UnitValue(width,"px");}else{if(!(width instanceof UnitValue)){width=originalWidth;}}if(typeof height==="number"){height=new UnitValue(height,"px");}else{if(!(height instanceof UnitValue)){if(width.type==="%"){height=new UnitValue(width.value,"%");height.baseUnit=new UnitValue(originalHeight.as("px"),"px");}else{height=originalHeight;}}}resolution=typeof resolution==="number"?resolution:originalResolution;typeof scaleStyles==="boolean"||(scaleStyles=true);if(width===originalWidth&&height===originalHeight&&resolution===originalResolution){return documents;}var desc=new ActionDescriptor();if(width/originalWidth===height/originalHeight){desc.putUnitDouble(c2id("Wdth"),c2id("#Pxl"),width.as("px"));desc.putBoolean(c2id("CnsP"),true);desc.putBoolean(s2id("scaleStyles"),scaleStyles);}else{desc.putUnitDouble(c2id("Wdth"),c2id("#Pxl"),width.as("px"));desc.putUnitDouble(c2id("Hght"),c2id("#Pxl"),height.as("px"));}if(resolution!==originalResolution){desc.putUnitDouble(c2id("Rslt"),c2id("#Rsl"),resolution);}switch(resampleMethod){case ResampleMethod.NEARESTNEIGHBOR:resampleMethod=s2id("nearestNeighbor");break;case ResampleMethod.BILINEAR:resampleMethod=s2id("bilinear");break;case ResampleMethod.BICUBIC:resampleMethod=s2id("bicubic");break;case ResampleMethod.BICUBICSHARPER:resampleMethod=s2id("bicubicSharper");break;case ResampleMethod.BICUBICSMOOTHER:resampleMethod=s2id("bicubicSmoother");break;default:resampleMethod=s2id("bicubicAutomatic");break;}desc.putEnumerated(c2id("Intr"),c2id("Intp"),resampleMethod);executeAction(c2id("ImgS"),desc,_dialogModesNo);return documents;};documents.duplicate=function(duplicateName,merge){var ref=new ActionReference();ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);if(typeof duplicateName==="string"&&duplicateName.length){desc.putString(c2id("Nm  "),duplicateName);}if(merge){desc.putBoolean(c2id("Mrgd"),true);}executeAction(c2id("Dplc"),desc,_dialogModesNo);return documents;};documents.flatten=function(){executeAction(c2id("FltI"),undefined,_dialogModesNo);return documents;};documents.findAll=_find.bind(null,documents,0);documents.findFirst=_find.bind(null,documents,1);documents.findLast=_find.bind(null,documents,2);documents.makeActive=function(documentId){if(typeof documentId!=="number"){throw new Error(["Invalid document identifier: ",documentId,"."].join(""));}var ref=new ActionReference();ref.putIdentifier(c2id("Dcmn"),documentId);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return documents;};documents.getActiveDocumentId=function(){if(documents.count()<1){return -1;}else{return documents.prop("documentId");}};documents.toDOM=function(){if(documents.count()<1){return null;}else{return app.activeDocument;}};Lifter.documents=documents;log.log("Lifter.documents done.");}());(function(){var filters={};filters.blur={};filters.blur.blur=function(){executeAction(c2id("Blr "),undefined,_dialogModesNo);return filters;};filters.blur.blurMore=function(){executeAction(c2id("BlrM"),undefined,_dialogModesNo);return filters;};filters.blur.gaussianBlur=function(radius){var desc=new ActionDescriptor();desc.putUnitDouble(c2id("Rds "),c2id("#Pxl"),+radius||1);executeAction(c2id("GsnB"),desc,DialogModes.NO);return filters;};filters.sharpen={};filters.sharpen.sharpen=function(){executeAction(c2id("Shrp"),undefined,_dialogModesNo);return filters;};filters.sharpen.sharpenEdges=function(){executeAction(c2id("ShrE"),undefined,_dialogModesNo);return filters;};filters.sharpen.sharpenMore=function(){executeAction(c2id("ShrM"),undefined,_dialogModesNo);return filters;};filters.render={};filters.render.clouds=function(){executeAction(c2id("Clds"),new ActionDescriptor(),_dialogModesNo);return filters;};Lifter.filters=filters;}());(function(){var history={};function _getHistoryIdRef(historyId,ref){if(typeof historyId!=="number"){ref.putEnumerated(c2id("HstS"),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(c2id("HstS"),historyId);}}function _traverseHistory(direction){var ref=new ActionReference();ref.putEnumerated(c2id("HstS"),c2id("Ordn"),direction);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return this;}history.supportedProperties={itemIndex:{typeId:c2id("ItmI"),type:DescValueType.INTEGERTYPE,set:false},historyId:{typeId:c2id("Idnt"),type:DescValueType.INTEGERTYPE,set:false},name:{typeId:c2id("Nm  "),type:DescValueType.STRINGTYPE,set:false},auto:{typeId:c2id("Auto"),type:DescValueType.BOOLEANTYPE,set:false},historyBrushSource:{typeId:c2id("HstB"),type:DescValueType.BOOLEANTYPE,set:false},currentHistoryState:{typeId:c2id("CrnH"),type:DescValueType.BOOLEANTYPE,set:false}};history.count=function(){var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("Cnt "));ref.putEnumerated(c2id("HstS"),c2id("Ordn"),c2id("Trgt"));return executeActionGet(ref).getInteger(c2id("Cnt "));};history.getHistoryIdFromItemIndex=function(itemIndex){var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("Idnt"));ref.putIndex(c2id("HstS"),itemIndex);return executeActionGet(ref).getInteger(c2id("Idnt"));};history.getActiveHistoryId=function(){return history.prop("historyId");};history.forEach=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;if(reverse){i=history.count()+1;n=0;while(--i>n){if(callback.call(context,i,history.getHistoryIdFromItemIndex(i))){break;}}}else{n=history.count()+1;i=0;while(++i<n){if(callback.call(context,i,history.getHistoryIdFromItemIndex(i))){break;}}}return history;};history.prop=function(){var historyId,name,value,ref,desc;if(typeof arguments[0]==="number"||(!arguments[0]&&arguments.length>1)){historyId=arguments[0];name=arguments[1];value=arguments[2];}else{name=arguments[0];value=arguments[1];}if(typeof name==="undefined"){ref=new ActionReference();_getHistoryIdRef(historyId,ref);desc=executeActionGet(ref);return _getWrappedActionDescriptor(desc,history.supportedProperties,historyId||desc.getInteger(c2id("Idnt")));}else{if(!history.supportedProperties.hasOwnProperty(name)){throw new Error(['Invalid history state property: "',name,'".'].join(""));}var prop=history.supportedProperties[name];if(typeof value==="undefined"){ref=new ActionReference();if(prop.typeId){ref.putProperty(c2id("Prpr"),prop.typeId);}_getHistoryIdRef(historyId,ref);desc=executeActionGet(ref);if(prop.get){return prop.get.call(null,prop,historyId,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}prop.set.call(null,prop,historyId,value);return history;}}};history.findAll=_find.bind(null,history,0);history.findFirst=_find.bind(null,history,1);history.findLast=_find.bind(null,history,2);history.makeActive=function(historyId){if(typeof historyId!=="number"||historyId<1){throw new Error(['Invalid history state identifier: "',historyId,'".'].join(""));}var ref=new ActionReference();ref.putIdentifier(c2id("HstS"),historyId);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return this;};history.makeActiveByOffset=function(offset){if(typeof offset!=="number"||offset>0){throw new Error(['Invalid history state offset: "',offset,'".'].join(""));}var ref=new ActionReference();ref.putOffset(c2id("HstS"),offset);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return this;};history.makePreviousActive=_traverseHistory.bind(null,c2id("Prvs"));history.makeNextActive=_traverseHistory.bind(null,c2id("Nxt "));history.makeFirstActive=_traverseHistory.bind(null,c2id("Frst"));history.makeLastActive=_traverseHistory.bind(null,c2id("Lst "));history.duplicate=function(){var ref=new ActionReference();ref.putClass(c2id("Dcmn"));var ref2=new ActionReference();ref2.putProperty(c2id("HstS"),c2id("CrnH"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("Usng"),ref2);executeAction(c2id("Mk  "),desc,_dialogModesNo);return this;};history.remove=function(historyId){var ref=new ActionReference();if(typeof historyId==="number"){ref.putIdentifer(c2id("HstS"),historyId);}else{ref.putProperty(c2id("HstS"),c2id("CrnH"));}var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);return history;};history.createSnapshot=function(snapshotName){var ref=new ActionReference();ref.putClass(c2id("SnpS"));var ref2=new ActionReference();ref2.putProperty(c2id("HstS"),c2id("CrnH"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("From"),ref2);if(typeof snapshotName==="string"&&snapshotName.length){desc.putString(c2id("Nm  "),snapshotName);}executeAction(c2id("Mk  "),desc,_dialogModesNo);return this;};history.makeSnapshotActive=function(snapshot){if(typeof snapshot!=="number"){snapshot=history.findFirst({name:snapshot});}return history.makeActive(snapshot);};history.deleteSnapshot=function(snapshot){var type=typeof snapshot,ref=new ActionReference();if(type==="string"&&snapshot.length){ref.putName(c2id("SnpS"),snapshot);}else{if(type==="number"&&snapshot>0){ref.putIdentifier(c2id("SnpS"),snapshot);}else{throw new Error(['Invalid snapshot identifier or name: "',snapshot,'".'].join(""));}}var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);return history;};Lifter.history=history;}());(function(){log.log("Lifter.layers loading...");var layers={};var _cache={};function _wrapSwitchActive(layerId,callback,context){if(typeof layerId==="number"&&layers.prop("layerId")!==layerId){layers.stack.makeActive(layerId);}callback.call(context);}function _getMakeLayerDescriptor(name,opacity,blendMode,color){var desc=new ActionDescriptor();if(typeof name==="string"&&name.length){desc.putString(c2id("Nm  "),name);}typeof opacity==="number"||(opacity=100);desc.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);(blendMode&&blendMode.valueOf)||(blendMode=BlendMode.NORMAL);desc.putEnumerated(c2id("Md  "),c2id("BlnM"),_ensureLifterBlendMode(blendMode).valueOf());(color&&color.valueOf)||(color=LayerColor.NONE);desc.putEnumerated(c2id("Clr "),c2id("Clr "),color.valueOf());return desc;}function _getLayerIdRef(layerId,ref){if(typeof layerId!=="number"||layerId===0){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(c2id("Lyr "),layerId);}}function _getItemIndexRef(itemIndex,ref){if(typeof itemIndex!=="number"){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{if(layers.count()===0){if(itemIndex!==1){throw new Error(['Could not find layer with ItemIndex "',itemIndex,'".'].join(""));}ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{if(layers.hasBackground()){itemIndex--;}ref.putIndex(c2id("Lyr "),itemIndex);}}return ref;}function _getStackId(direction){if(layers.count()===0){return 0;}else{var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("LyrI"));ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),direction);return executeActionGet(ref).getInteger(c2id("LyrI"));}return layers;}function _traverseStack(direction){if(layers.count()===0){return;}layers.stack.makeActive(_getStackId(direction));return layers;}layers.ref=function(layerId,ref){ref=ref||new ActionReference();_getLayerIdRef(layerId,ref);return ref;};layers.desc=function(layerId,ref,desc){desc=desc||new ActionDescriptor();desc=executeActionGet(layers.ref(layerId,ref));return desc;};layers.supportedProperties={itemIndex:{typeId:c2id("ItmI"),type:DescValueType.INTEGERTYPE,set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set ItemIndex on background layer.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var ref2=new ActionReference();ref2.putIndex(c2id("Lyr "),value);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);desc.putBoolean(c2id("Adjs"),false);desc.putInteger(c2id("Vrsn"),5);executeAction(c2id("move"),desc,_dialogModesNo);}},layerId:{typeId:c2id("LyrI"),type:DescValueType.INTEGERTYPE,set:false},name:{typeId:c2id("Nm  "),type:DescValueType.STRINGTYPE,defaultValue:"Layer",set:function(prop,layerId,value){_wrapSwitchActive(layerId,function(){var ref=new ActionReference();ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putString(prop.typeId,value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}},color:{typeId:c2id("Clr "),type:DescValueType.ENUMERATEDTYPE,defaultValue:LayerColor.NONE,get:function(prop,layerId,desc){return Enumeration.fromValue(LayerColor,desc.getEnumerationValue(prop.typeId));},set:function(prop,layerId,value){_wrapSwitchActive(layerId,function(){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putEnumerated(c2id("Clr "),c2id("Clr "),value.valueOf());desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}},visible:{typeId:c2id("Vsbl"),type:DescValueType.BOOLEANTYPE,defaultValue:true,set:function(prop,layerId,value){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var list=new ActionList();list.putReference(ref);var desc=new ActionDescriptor();desc.putList(c2id("null"),list);if(value){executeAction(c2id("Shw "),desc,_dialogModesNo);}else{executeAction(c2id("Hd  "),desc,_dialogModesNo);}}},opacity:{typeId:c2id("Opct"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){var oldVisible=layers.prop(layerId,"visible");if(!oldVisible){layers.prop(layerId,"visible",true);}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);if(!oldVisible){layers.prop(layerId,"visible",false);}}},fillOpacity:{typeId:s2id("fillOpacity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Applying fill opacity to layer sets is not supported by Action Manager (nor by DOM).");}var oldVisible=layers.prop(layerId,"visible");if(!oldVisible){layers.prop(layerId,"visible",true);}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);if(!oldVisible){layers.prop(layerId,"visible",false);}}},blendMode:{typeId:c2id("Md  "),type:DescValueType.ENUMERATEDTYPE,defaultValue:BlendMode.NORMAL,get:function(prop,layerId,desc){return Enumeration.fromValue(LifterBlendMode,desc.getEnumerationValue(prop.typeId));},set:function(prop,layerId,value){value=_ensureLifterBlendMode(value).valueOf();var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putEnumerated(prop.typeId,c2id("BlnM"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},type:{typeId:s2id("layerSection"),type:DescValueType.ENUMERATEDTYPE,get:function(prop,layerId,desc){var type=typeIDToStringID(desc.getEnumerationValue(prop.typeId));switch(type){case"layerSectionStart":return LayerType.SETSTART;case"layerSectionEnd":return LayerType.SETEND;case"layerSectionContent":return LayerType.CONTENT;default:throw new Error(['Unsupported layer type encountered: "',type,'".'].join(""));}},set:false},kind:{get:function(prop,layerId,desc){if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error('Unable to get "kind" for layer sets.');}if(desc.hasKey(s2id("textKey"))){return LayerKind.TEXT;}if(desc.hasKey(s2id("smartObject"))){return LayerKind.SMARTOBJECT;}if(desc.hasKey(s2id("layer3D"))){return LayerKind.LAYER3D;}var adjustmentType=s2id("adjustment");if(desc.hasKey(adjustmentType)){var adjustmentKind=typeIDToStringID(desc.getList(adjustmentType).getClass(0));switch(adjustmentKind){case"photoFilter":return LayerKind.PHOTOFILTER;case"solidColorLayer":return LayerKind.SOLIDFILL;case"gradientMapClass":return LayerKind.GRADIENTMAP;case"gradientMapLayer":return LayerKind.GRADIENTFILL;case"hueSaturation":return LayerKind.HUESATURATION;case"colorLookup":return;case"colorBalance":return LayerKind.COLORBALANCE;case"patternLayer":return LayerKind.PATTERNFILL;case"invert":return LayerKind.INVERSION;case"posterization":return LayerKind.POSTERIZE;case"thresholdClassEvent":return LayerKind.THRESHOLD;case"blackAndWhite":return LayerKind.BLACKANDWHITE;case"selectiveColor":return LayerKind.SELECTIVECOLOR;case"vibrance":return LayerKind.VIBRANCE;case"brightnessEvent":return LayerKind.BRIGHTNESSCONTRAST;case"channelMixer":return LayerKind.CHANNELMIXER;case"curves":return LayerKind.CURVES;case"exposure":return LayerKind.EXPOSURE;default:return adjustmentKind;}}return LayerKind.NORMAL;},set:false},bounds:{typeId:s2id("bounds"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},boundsNoEffects:{typeId:s2id("boundsNoEffects"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},boundsNoMask:{typeId:s2id("boundsNoMask"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},group:{typeId:c2id("Grup"),type:DescValueType.BOOLEANTYPE,set:false},hasLayerMask:{typeId:s2id("hasUserMask"),type:DescValueType.BOOLEANTYPE,set:false},layerMaskEnabled:{typeId:s2id("userMaskEnabled"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask enabled: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask enabled: layer does not have a layer mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(c2id("UsrM"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},layerMaskLinked:{typeId:s2id("userMaskLinked"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask Linked: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask Linked: layer does not have a layer mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(c2id("Usrs"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},layerMaskDensity:{typeId:s2id("userMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask density: layer does not have a layer mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask density: layer does not have a layer mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},layerMaskFeather:{typeId:s2id("userMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask feather: layer does not have a layer mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask feather: layer does not have a layer mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},hasVectorMask:{typeId:s2id("hasVectorMask"),type:DescValueType.BOOLEANTYPE,set:false},vectorMaskEnabled:{typeId:s2id("vectorMaskEnabled"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get layer mask enabled: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set layer mask enabled: layer does not have a vector mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(s2id("vectorMaskEnabled"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},vectorMaskLinked:{typeId:s2id("vectorMaskLinked"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){throw new Error('Layer property "vectorMaskLinked" can only be set, never read. It simply does not exist.');},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set layer mask Linked: layer does not have a vector mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(s2id("vectorMaskLinked"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},vectorMaskDensity:{typeId:s2id("vectorMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get vector mask density: layer does not have a vector mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set vector mask density: layer does not have a vector mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},vectorMaskFeather:{typeId:s2id("vectorMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get vector mask feather: layer does not have a vector mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set vector mask feather: layer does not have a vector mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},hasFilterMask:{typeId:s2id("hasFilterMask"),type:DescValueType.BOOLEANTYPE,set:false},filterMaskDensity:{typeId:s2id("filterMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to get filter mask density: layer does not have a filter mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to set filter mask density: layer does not have a filter mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},filterMaskFeather:{typeId:s2id("filterMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to get filter mask feather: layer does not have a layer mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to set filter mask feather: layer does not have a filter mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},allLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectAll"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){if(value){throw new Error("Unable to set lock on background layer.");}else{_wrapSwitchActive(layerId,layers.makeLayerFromBackground);}}else{_wrapSwitchActive(layerId,function(){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectAll"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}}},pixelsLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectComposite"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set pixels lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Pixels lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectComposite"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},positionLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectPosition"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set position lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Position lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectPosition"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},transparentPixelsLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectTransparency"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set transparency lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Transparency lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectTransparency"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},isBackgroundLayer:{typeId:c2id("Bckg"),type:DescValueType.BOOLEANTYPE,get:function(prop,layerId,desc){return layerId===0||desc.getBoolean(prop.typeId);},set:false},xmpMetadata:{typeId:s2id("metadata"),type:DescValueType.OBJECTTYPE,set:false},lastModified:{typeId:s2id("metadata"),type:DescValueType.DOUBLETYPE,get:function(prop,layerId,desc){var lastModified=new Date();lastModified.setTime(desc.getObjectValue(prop.typeId).getDouble(s2id("layerTime"))*1000);return lastModified;},set:false},smartObject:{typeId:s2id("smartObject"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return desc.getObjectValue(prop.typeId);}},set:false},smartObjectMore:{typeId:s2id("smartObjectMore"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return desc.getObjectValue(prop.typeId);}},set:false},"smartObject.link":{typeId:s2id("smartObject"),type:DescValueType.ALIASTYPE,get:function(prop,layerId,desc){if(!desc.hasKey(prop.typeId)){return;}var soDesc=layers.prop(layerId,"smartObject");if(soDesc&&soDesc.hasKey(s2id("link"))&&soDesc.getType(s2id("link"))==prop.type){return String(soDesc.getPath(s2id("link")));}},set:function(prop,layerId,value){try{var desc=new ActionDescriptor();desc.putPath(c2id("null"),_ensureFile(value));executeAction(s2id("placedLayerRelinkToFile"),desc,DialogModes.NO);}catch(e){throw new Error("Can not relink smart object..."+e.message);}}},"smartObject.compsList":{typeId:s2id("smartObject"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){var compsDesc=layers.prop(layerId,"smartObject").getObjectValue(s2id("compsList"));if(compsDesc&&compsDesc.hasKey(s2id("compList"))){var compList=compsDesc.getList(s2id("compList"));var compObj={};for(var c=compList.count-1;c>=0;c--){var compObjDesc=compList.getObjectValue(c);var compObjID=compObjDesc.getInteger(s2id("ID"));compObj[compObjID]=compObjDesc.getString(s2id("name"));}return compObj;}}},set:false},"smartObjectMore.comp":{typeId:s2id("smartObjectMore"),type:DescValueType.INTEGERTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return layers.prop(layerId,"smartObjectMore").getInteger(s2id("comp"));}},set:function(prop,layerId,value){try{value=(typeof value==="number"&&value>=0)?value:-1;var ref=layers.ref(layerId);if(executeActionGet(ref).hasKey(prop.typeId)){var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putInteger(s2id("compID"),value);executeAction(s2id("setPlacedLayerComp"),desc,DialogModes.NO);}}catch(e){throw new Error("Can not set comp on smart object..."+e.message);}}},"smartObjectMore.resolution":{typeId:s2id("smartObjectMore"),type:DescValueType.UNITDOUBLE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return layers.prop(layerId,"smartObjectMore").getDouble(s2id("resolution"));}},set:false}};layers.count=function(){if(_cache.hasOwnProperty("layerCount")){return _cache.layerCount;}var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("NmbL"));ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var count=executeActionGet(ref).getInteger(c2id("NmbL"));if(count>0){if(_cache.hasOwnProperty("hasBackground")){if(_cache.hasBackground){count++;}}else{ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("Bckg"));ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Back"));if(executeActionGet(ref).getBoolean(c2id("Bckg"))){count++;}}}return count;};layers.getLayerIdByItemIndex=function(itemIndex){var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("LyrI"));_getItemIndexRef(itemIndex,ref);return executeActionGet(ref).getInteger(c2id("LyrI"));};layers.hasBackground=function(){if(_cache.hasOwnProperty("hasBackground")){return _cache.hasBackground;}if(Lifter.layers.count()===0){return true;}else{var ref=new ActionReference();ref.putProperty(c2id("Prpr"),s2id("hasBackgroundLayer"));ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var desc=executeActionGet(ref);var res=desc.getBoolean(s2id("hasBackgroundLayer"));return res;}};layers.add=function(name,opacity,blendMode,color){var ref=new ActionReference();ref.putClass(c2id("Lyr "));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("Usng"),c2id("Lyr "),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.addLayerSet=function(name,opacity,blendMode,color){var ref=new ActionReference();ref.putClass(s2id("layerSection"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("Usng"),s2id("layerSection"),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.remove=function(layerId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);return layers;};layers.makeLayerFromBackground=function(name,opacity,blendMode,color){if(!Lifter.layers.hasBackground()){return;}var ref=new ActionReference();ref.putProperty(c2id("Lyr "),c2id("Bckg"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("T   "),c2id("Lyr "),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.duplicate=function(layerId,documentId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);if(documentId){var ref2=new ActionReference();ref.putIdentifier(c2id("Dcmn"),documentId);desc.putReference(c2id("T   "),ref2);}desc.putInteger(c2id("Vrsn"),5);executeAction(c2id("Dplc"),desc,_dialogModesNo);return layers;};layers.applyImage=function(sourceDocumentId,sourceLayerId,sourceChannel,invert,blendMode,opacity,preserveTransparency){if(!Lifter.documents){throw new Error("Lifter.layers.applyImage requires the Lifter.documents library.");}if(typeof sourceDocumentId!=="number"){sourceDocumentId=Lifter.documents.getActiveDocumentId();}if(sourceLayerId!=="merged"&&typeof sourceLayerId!=="number"){sourceLayerId=layers.stack.getActiveLayerId();}if(sourceChannel){if(!Enumeration.contains(ApplyImageChannel,sourceChannel)){throw new TypeError("Invalid sourceChannel:"+sourceChannel);}}else{sourceChannel=ApplyImageChannel.RGB;}typeof invert==="boolean"||(invert=false);(blendMode&&blendMode.valueOf)||(blendMode=LifterBlendMode.NORMAL);blendMode=_ensureLifterBlendMode(blendMode);typeof opacity==="number"||(opacity=100);typeof preserveTransparency==="boolean"||(preserveTransparency=true);var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),sourceChannel.valueOf());if(sourceLayerId==="merged"){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Mrgd"));}else{var activeDocId=Lifter.documents.getActiveDocumentId();Lifter.documents.makeActive(sourceDocId);if(layers.prop("isBackgroundLayer")){ref.putProperty(c2id("Lyr "),c2id("Bckg"));}else{ref.putIdentifier(c2id("Lyr "),sourceLayerId);}Lifter.documents.makeActive(activeDocId);}ref.putIdentifier(c2id("Dcmn"),sourceDocumentId);var desc2=new ActionDescriptor();desc2.putReference(c2id("T   "),ref);desc2.putEnumerated(c2id("Clcl"),c2id("Clcn"),blendMode.valueOf());desc2.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);desc2.putBoolean(c2id("PrsT"),preserveTransparency);desc2.putBoolean(c2id("Invr"),invert);var desc=new ActionDescriptor();desc.putObject(c2id("With"),c2id("Clcl"),desc2);executeAction(c2id("AppI"),desc,_dialogModesNo);return layers;};layers.invert=function(layerId){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}executeAction(c2id("Invr"),undefined,_dialogModesNo);return layers;};layers.fill=function(layerId,fillColor,blendMode,opacity){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}(fillColor)||(fillColor=app.backgroundColor);if(!(fillColor instanceof SolidColor)){throw new Error("Fill color must be a valid SolidColor: "+fillColor);}(blendMode&&blendMode.valueOf)||(blendMode=LifterBlendMode.NORMAL);blendMode=_ensureLifterBlendMode(blendMode);typeof opacity==="number"||(opacity=100);var desc=new ActionDescriptor();desc.putEnumerated(c2id("Usng"),c2id("FlCn"),c2id("Clr "));var desc2=new ActionDescriptor();desc2.putUnitDouble(c2id("H   "),c2id("#Ang"),fillColor.hsb.hue);desc2.putDouble(c2id("Strt"),fillColor.hsb.saturation);desc2.putDouble(c2id("Brgh"),fillColor.hsb.brightness);desc.putObject(c2id("Clr "),c2id("HSBC"),desc2);desc.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);desc.putEnumerated(c2id("Md  "),c2id("BlnM"),blendMode.valueOf());executeAction(c2id("Fl  "),desc,_dialogModesNo);return layers;};layers.forEach=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;delete _cache.hasBackground;delete _cache.layerCount;_cache.hasBackground=layers.hasBackground();_cache.layerCount=layers.count();if(reverse){i=_cache.layerCount+1;n=0;while(--i>n){if(callback.call(context,i,layers.getLayerIdByItemIndex(i))){break;}}}else{n=_cache.layerCount+1;i=0;while(++i<n){if(callback.call(context,i,layers.getLayerIdByItemIndex(i))){break;}}}delete _cache.hasBackground;delete _cache.layerCount;return layers;};layers.forEachSelected=layers.forEachActive=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;var activeLayerIds=layers.stack.getActiveLayerIds();if(reverse){i=activeLayerIds.length;n=0;while(--i>=n){if(callback.call(context,i,activeLayerIds[i])){break;}}}else{n=activeLayerIds.length;i=0;while(i<n){if(callback.call(context,i,activeLayerIds[i])){break;}i++;}}return layers;};layers.prop=function(){var layerId,name,value,ref,desc;if(typeof arguments[0]==="number"||(!arguments[0]&&arguments.length>1)){layerId=arguments[0];name=arguments[1];value=arguments[2];}else{name=arguments[0];value=arguments[1];}if(typeof name==="undefined"){ref=new ActionReference();_getLayerIdRef(layerId,ref);desc=executeActionGet(ref);return _getWrappedActionDescriptor(desc,layers.supportedProperties,layerId||desc.getInteger(c2id("LyrI")));}else{if(!layers.supportedProperties.hasOwnProperty(name)){if(typeof value==="undefined"){try{return _getDescPropByName(layers.desc(layerId),name);}catch(e){log.warn(['Invalid layer property: "',name,'".'].join(""));return;}}else{throw new Error(['Setting property "',name,'" is not supported by Lifter.'].join(""));}}var prop=layers.supportedProperties[name];if(typeof value==="undefined"){ref=new ActionReference();if(prop.typeId){ref.putProperty(c2id("Prpr"),prop.typeId);}_getLayerIdRef(layerId,ref);try{desc=executeActionGet(ref);}catch(e){throw new Error("Unable to find "+typeIDToStringID(prop.typeId)+": layers do not have that property or it is un-gettable.");}if(prop.get){return prop.get.call(null,prop,layerId,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}if(layers.prop(layerId,"type")===LayerType.SETEND){throw new Error(["Setting properties on a layer of type ",LayerType.SETEND.toString()," is not supported."].join(""));}prop.set.call(null,prop,layerId,value);return layers;}}};layers.findAllByName=function(search){var regex=(typeof search==="string")?new RegExp("^"+search+"$"):new RegExp(search);var matchIDs=[];layers.forEach(function(itemIndex,layerId){if(layers.prop(layerId,"name").search(regex)!==-1){matchIDs.push(layerId);}});return matchIDs;};layers.findAll=_find.bind(null,layers,0);layers.findFirst=_find.bind(null,layers,1);layers.findLast=_find.bind(null,layers,2);layers.getParentGroupIds=function(layerId){var parentIDs=[];var tgtId=(typeof layerId=="number")?layerId:layers.prop("layerId");layers.forEach(function(itemIndex,layerId){if(layers.prop(layerId,"type")==LayerType.SETSTART){parentIDs.push(layers.prop(layerId,"name"));}else{if(layers.prop(layerId,"type")==LayerType.SETEND){parentIDs.pop();}else{if(layerId==tgtId){return parentIDs;}}}},null,true);return parentIDs;};layers.getAllLayerIds=function(){var allIDs=[];layers.forEach(function(itemIndex,layerId){allIDs.push(layerId);});return allIDs;};layers.getAllActiveLayerIds=function(){var activeLayerIds=[];var docRef=new ActionReference();docRef.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var docDesc=executeActionGet(docRef);if(docDesc.hasKey(s2id("targetLayersIDs"))){targetLayersIDsDesc=docDesc.getList(s2id("targetLayersIDs"));for(var ii=0;ii<targetLayersIDsDesc.count;ii++){activeLayerIds.push(Number(targetLayersIDsDesc.getReference(ii).getIdentifier()));}}return activeLayerIds;};layers.stack={};layers.stack.getActiveLayerIds=layers.getAllActiveLayerIds;_stackCache={};layers.stack.saveIdList=function(cacheId,layerIds){if(typeof cacheId!=="number"){cacheId=0;}if(typeof layerIds!=="object"){layerIds=layers.getAllLayerIds();}_stackCache[cacheId]=[].concat(layerIds);return layers;};layers.stack.saveActiveIds=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}layers.stack.saveIdList(cacheId,layers.getAllActiveLayerIds());return layers;};layers.stack.getIdList=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}return _stackCache[cacheId];};layers.stack.restoreIdList=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}layers.stack.makeActive(layers.stack.getIdList(cacheId));delete _stackCache[cacheId];return layers;};layers.stack.getActiveLayerId=function(){return layers.prop("layerId");};layers.stack.getFrontLayerId=_getStackId.bind(null,c2id("Frnt"));layers.stack.getBottomLayerId=_getStackId.bind(null,c2id("Back"));layers.stack.getNextLayerId=_getStackId.bind(null,c2id("Frwr"));layers.stack.getPreviousLayerId=_getStackId.bind(null,c2id("Bckw"));layers.stack.makeActive=function(layerIdList,makeVisible,add){if(add!==true){layers.stack.makeNoneActive();}layerIdList=[].concat(layerIdList);for(i=0;i<layerIdList.length;i++){layerId=layerIdList[i];if(typeof layerId!=="number"||layerId<1){throw new Error("Invalid layerId: "+layerId);}makeVisible===true||(makeVisible=false);var ref=new ActionReference();ref.putIdentifier(c2id("Lyr "),layerId);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("MkVs"),makeVisible);desc.putEnumerated(s2id("selectionModifier"),s2id("selectionModifierType"),s2id("addToSelection"));executeAction(c2id("slct"),desc,_dialogModesNo);}return layers;};layers.stack.makeAllActive=function(){layers.stack.makeActive(layers.getAllLayerIds());};layers.stack.makeFrontActive=_traverseStack.bind(null,c2id("Frnt"));layers.stack.makeBottomActive=_traverseStack.bind(null,c2id("Back"));layers.stack.makeNextActive=_traverseStack.bind(null,c2id("Frwr"));layers.stack.makePreviousActive=_traverseStack.bind(null,c2id("Bckw"));layers.stack.makeNoneActive=function(){var desc=new ActionDescriptor();var ref=new ActionReference();ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),s2id("targetEnum"));desc.putReference(c2id("null"),ref);executeAction(s2id("selectNoLayers"),desc,_dialogModesNo);return layers;};layers.groups={};layers.groups.isGroup=function(layerId){return layers.prop(layerId,"type")==LayerType.SETSTART;},layers.isGroup=layers.groups.isGroup,layers.groups.make=function(name,addLayers,layerIds,color){var idLyr=s2id("layer");var idOrdn=c2id("Ordn");var idTrgt=s2id("targetEnum");var idnull=c2id("null");var refLyr;var descMake=new ActionDescriptor();var refClass=new ActionReference();refClass.putClass(s2id("layerSection"));descMake.putReference(idnull,refClass);if(typeof layerIds==="number"){layerIds=[layerIds];}if(addLayers){if(Array.isArray(layerIds)){layers.stack.makeActive(layerIds);}refLyr=new ActionReference();refLyr.putEnumerated(idLyr,idOrdn,idTrgt);descMake.putReference(c2id("From"),refLyr);}executeAction(s2id("make"),descMake,DialogModes.NO);if(name!==undefined&&name.length){var descSet=new ActionDescriptor();refLyr=new ActionReference();refLyr.putEnumerated(idLyr,idOrdn,idTrgt);descSet.putReference(idnull,refLyr);var descName=new ActionDescriptor();descName.putString(s2id("name"),name);descSet.putObject(s2id("to"),idLyr,descName);executeAction(s2id("set"),descSet,DialogModes.NO);}return layers;},layers.groups.merge=function(layerId){layers.stack.makeActive(layerId);executeAction(c2id("Mrg2"),undefined,DialogModes.NO);return layers;},layers.smartObjects={};function _ensureSmartObjectIsActive(layerId){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}if(layers.prop("kind")!==LayerKind.SMARTOBJECT){throw new Error("Layer "+layers.prop(null,"name")+" must be a smart object.");}}layers.smartObjects.make=function(layerId,isLink,imageFile){_ensureSmartObjectIsActive(layerId);executeAction(s2id("newPlacedLayer"),undefined,_dialogModesNo);if(isLink){layers.smartObjects.convertToLinked(null,imageFile);}return layers;};layers.smartObjects.makeCopy=function(layerId,imageFile,skipPrompt){_ensureSmartObjectIsActive(layerId);var srcLinkPath=layers.prop("smartObject.link");if(srcLinkPath){var srcFile=new File(srcLinkPath);var searchIdx=srcFile.name.lastIndexOf(".");var srcLinkExtension=srcFile.name.slice(searchIdx,srcFile.name.length);var srcLinkBaseName=srcFile.name.slice(0,searchIdx);var srcLinkNameNumber=srcLinkBaseName.match(/\d*$/)[0];if(srcLinkNameNumber.length){srcLinkBaseName=srcLinkBaseName.substr(0,srcLinkBaseName.length-srcLinkNameNumber.length);srcLinkBaseName+=Number(Number(srcLinkNameNumber)+1).pad(srcLinkNameNumber.length);}else{srcLinkBaseName+="_02";}var newLinkName=srcLinkBaseName+srcLinkExtension;if(!skipPrompt){newLinkName=prompt("Enter a name for the new file to be linked...",newLinkName,"New File Name");if(typeof newLinkName!=="string"){return;}if(newLinkName.search(srcLinkExtension)===-1){newLinkName+=srcLinkExtension;}}newLinkFile=new File(srcFile.parent+"/"+newLinkName);if(newLinkFile.absoluteURI===srcFile.absoluteURI){alert("But... that's the same file... "+newLinkName,"Nooooooo!");return;}newLinkFile=Lifter.system.files.copy(srcFile,newLinkFile);if(typeof newLinkFile==="undefined"){return;}if(!newLinkFile.exists){log.error("Error copying file. No file found at destination: "+newLinkFile.name);return;}var newFilePath=newLinkFile.absoluteURI;var soMoreDesc=layers.prop("smartObjectMore");var compAppliedID=soMoreDesc.getInteger(s2id("comp"));var sizeKeyDesc=soMoreDesc.getObjectValue(c2id("Sz  "));var soWidthInner=sizeKeyDesc.getDouble(s2id("width"));var soHeightInner=sizeKeyDesc.getDouble(s2id("height"));var soVertList=soMoreDesc.getList(s2id("nonAffineTransform"));var soX=soVertList.getDouble(0);var soY=soVertList.getDouble(1);var soWidthPlaced=soVertList.getDouble(2)-soVertList.getDouble(0);var soHeightPlaced=soVertList.getDouble(5)-soVertList.getDouble(1);var soDPIRatio=soMoreDesc.getDouble(s2id("resolution"))/app.activeDocument.resolution;var soScaleX=(soWidthPlaced/soWidthInner)*soDPIRatio;var soScaleY=(soHeightPlaced/soHeightInner)*soDPIRatio;layers.smartObjects.place(newLinkFile,true,soX,soY,soScaleX,soScaleY);layers.smartObjects.setComp(null,compAppliedID);}else{executeAction(s2id("placedLayerMakeCopy"),undefined,_dialogModesNo);}return layers;};layers.smartObjects.edit=function(layerId){_ensureSmartObjectIsActive(layerId);var desc=new ActionDescriptor();executeAction(s2id("placedLayerEditContents"),desc,DialogModes.NO);var activeDocId=Lifter.documents.getActiveDocumentId();Lifter.documents.makeActive(activeDocId);delete _cache.hasBackground;delete _cache.layerCount;return layers;};layers.smartObjects.place=function(imageFile,isLink,posX,posY,scaleX,scaleY){scaleX=(scaleX!==undefined)?scaleX:100;scaleY=(scaleY!==undefined)?scaleY:100;if(!imageFile){imageFile=File.openDialog();if(!imageFile){throw new ERROR("User aborted convert to linked object...");}}try{var descPlace=new ActionDescriptor();var idPrc=c2id("#Prc");descPlace.putPath(c2id("null"),_ensureFile(imageFile));descPlace.putEnumerated(c2id("FTcs"),c2id("QCSt"),c2id("Qcsa"));if(isLink){descPlace.putBoolean(c2id("Lnkd"),true);}executeAction(c2id("Plc "),descPlace,DialogModes.NO);var newLinkedLayer=app.activeDocument.activeLayer;var soMoreDesc=layers.prop("smartObjectMore");var sizeKeyDesc=soMoreDesc.getObjectValue(c2id("Sz  "));var soWidthInner=sizeKeyDesc.getDouble(s2id("width"));var soHeightInner=sizeKeyDesc.getDouble(s2id("height"));var soVertList=soMoreDesc.getList(s2id("nonAffineTransform"));var soX=soVertList.getDouble(0);var soY=soVertList.getDouble(1);var soWidthPlaced=soVertList.getDouble(2)-soVertList.getDouble(0);var soHeightPlaced=soVertList.getDouble(5)-soVertList.getDouble(1);var tgtWidth=(scaleX/100)*soWidthInner;var tgtHeight=(scaleY/100)*soHeightInner;var soDPIRatio=soMoreDesc.getDouble(s2id("resolution"))/app.activeDocument.resolution;var newScaleX=(tgtWidth/soWidthPlaced)/soDPIRatio;var newScaleY=(tgtHeight/soHeightPlaced)/soDPIRatio;newScaleX*=100;newScaleY*=100;if(typeof posX=="number"&&typeof posY=="number"){newLinkedLayer.translate(-(soX-posX)+" px",-(soY-posY)+" px");}newLinkedLayer.resize(newScaleX,newScaleY,AnchorPosition.TOPLEFT);}catch(e){throw new Error("Can not place new smart object..."+e.message);}return layers;};layers.smartObjects.convertToLinked=function(layerId,imageFile){if(layers.prop("kind")!==LayerKind.SMARTOBJECT){layers.smartObjects.make(layerId,true,imageFile);}else{if(!imageFile){imageFile=File.openDialog();if(!imageFile){throw new ERROR("User aborted convert to linked object...");}}try{var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putPath(c2id("Usng"),_ensureFile(imageFile));executeAction(s2id("placedLayerConvertToLinked"),desc,DialogModes.NO);}catch(e){throw new Error("Can not convert to linked object..."+e.message);}}return layers;};layers.smartObjects.setComp=function(layerId,compID){var cacheId=new Date().getMilliseconds();layers.stack.saveActiveIds(cacheId);layers.prop(layerId,"smartObjectMore.comp",compID);layers.stack.restoreIdList(cacheId);return layers;};layers.masks={};layers.masks.hasMask=function(layerId){return(layers.prop(layerId,"hasUserMask")||layers.prop(layerId,"hasVectorMask"));};layers.masks.hasLayerMask=function(layerId){return layers.prop(layerId,"hasUserMask");};layers.masks.hasVectorMask=function(layerId){return layers.prop(layerId,"hasVectorMask");};layers.masks.hasFilterMask=function(layerId){return layers.prop(layerId,"hasFilterMask");};layers.masks.addLayerMask=function(layerId){if(layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to add layer mask: layer already has one.");}if(layers.prop(layerId,"isBackgroundLayer")){layers.makeLayerFromBackground();layers.stack.makeBottomActive();}else{if(typeof layerId==="number"){layers.stack.makeActive(layerId);}}var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));var desc=new ActionDescriptor();desc.putClass(c2id("Nw  "),c2id("Chnl"));desc.putReference(c2id("At  "),ref);try{tmpTest=app.activeDocument.selection.bounds.length;desc.putEnumerated(c2id("Usng"),c2id("UsrM"),c2id("RvlS"));}catch(err){desc.putEnumerated(c2id("Usng"),c2id("UsrM"),c2id("RvlA"));}executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.masks.addVectorMask=function(layerId){if(layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to add vector mask: layer already has one.");}if(layers.prop(layerId,"isBackgroundLayer")){layers.makeLayerFromBackground();}if(typeof layerId==="number"){layers.stack.makeActive(layerId);}var ref=new ActionReference();ref.putClass(c2id("Path"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var ref2=new ActionReference();ref2.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));desc.putReference(c2id("At  "),ref2);desc.putEnumerated(c2id("Usng"),s2id("vectorMaskEnabled"),c2id("RvlA"));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.masks.removeLayerMask=function(){_overloadFunction_Number_Bool(arguments,undefined,false);var layerId=arguments[0],apply=arguments[1];var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("Aply"),apply);executeAction(c2id("Dlt "),desc,_dialogModesNo);return layers;};layers.masks.removeVectorMask=function(){_overloadFunction_Number_Bool(arguments,undefined,false);var layerId=arguments[0],apply=arguments[1],desc=new ActionDescriptor();if(apply){var hasUserMask=layers.masks.hasLayerMask(layerId);var rasterizeLayerId=s2id("rasterizeLayer");layers.stack.saveActiveIds(rasterizeLayerId);layers.stack.makeActive(layerId);desc.putReference(c2id("null"),layers.ref(layerId));desc.putEnumerated(c2id("What"),s2id("rasterizeItem"),s2id("vectorMask"));executeAction(rasterizeLayerId,desc,DialogModes.NO);if(!hasUserMask){layers.masks.removeLayerMask(layerId,true);}layers.stack.restoreIdList(rasterizeLayerId);}else{var ref=new ActionReference();ref.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);}return layers;};layers.masks.makeLayerMaskActive=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],active=arguments[1];var channel=(active)?"Msk ":"RGB ";var ref=new ActionReference(),desc=new ActionDescriptor();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id(channel));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return layers;};layers.masks.makeVectorMaskActive=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],active=arguments[1];var ref=new ActionReference(),desc=new ActionDescriptor(),execId;if(active){ref.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref);execId=c2id("slct");}else{ref.putClass(c2id("Path"));_getLayerIdRef(layerId,ref);execId=c2id("Dslc");}desc.putReference(c2id("null"),ref);executeAction(execId,desc,_dialogModesNo);return layers;};layers.masks.makeLayerMaskVisible=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],visible=arguments[1];var ref=new ActionReference(),desc=new ActionDescriptor();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("MkVs"),visible);executeAction(c2id("slct"),desc,_dialogModesNo);return layers;};layers.masks.enable=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];if(layers.masks.hasLayerMask(layerId)){layers.masks.enableLayerMask(layerId,enable);}if(layers.masks.hasVectorMask(layerId)){layers.masks.enableVectorMask(layerId,enable);}return layers;};layers.masks.enableLayerMask=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];layers.prop(layerId,"layerMaskEnabled",enable);return layers;};layers.masks.enableVectorMask=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];layers.prop(layerId,"vectorMaskEnabled",enable);return layers;};layers.masks.selectLayerMask=function(layerId){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var ref2=new ActionReference();ref2.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.masks.selectVectorMask=function(layerId){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var ref2=new ActionReference();ref2.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref2);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);desc.putInteger(c2id("Vrsn"),1);desc.putBoolean(s2id("vectorMaskParams"),true);executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.masks.setMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],setLink=arguments[1];if(layers.masks.hasLayerMask(layerId)){layers.masks.setLayerMaskLink(layerId,setLink);}if(layers.masks.hasVectorMask(layerId)){layers.masks.setVectorMaskLink(layerId,setLink);}return layers;};layers.masks.setLayerMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);if(layers.masks.hasLayerMask(arguments[0])){layers.prop(arguments[0],"layerMaskLinked",arguments[1]);}};layers.masks.setVectorMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);if(layers.masks.hasLayerMask(arguments[0])){layers.prop(arguments[0],"vectorMaskLinked",arguments[1]);}return layers;};layers.masks.refineLayerMask=function(layerId,edgeBorderRadius,edgeBorderContrast,edgeSmooth,edgeFeatherRadius,edgeChoke,edgeAutoRadius,edgeDecontaminate){typeof edgeBorderRadius==="number"||(edgeBorderRadius=0);typeof edgeBorderContrast==="number"||(edgeBorderContrast=0);typeof edgeSmooth==="number"||(edgeSmooth=0);typeof edgeFeatherRadius==="number"||(edgeFeatherRadius=0);typeof edgeChoke==="number"||(edgeChoke=0);typeof edgeAutoRadius==="boolean"||(edgeAutoRadius=false);typeof edgeDecontaminate==="boolean"||(edgeDecontaminate=false);var desc=new ActionDescriptor();desc.putReference(c2id("null"),layers.ref(layerId));desc.putUnitDouble(s2id("refineEdgeBorderRadius"),c2id("#Pxl"),Math.abs(edgeBorderRadius));desc.putUnitDouble(s2id("refineEdgeBorderContrast"),idPrc,Math.abs(edgeBorderContrast));desc.putInteger(s2id("refineEdgeSmooth"),Math.abs(Math.ceil(edgeSmooth)));desc.putUnitDouble(s2id("refineEdgeFeatherRadius"),c2id("#Pxl"),Math.abs(edgeFeatherRadius));desc.putUnitDouble(s2id("refineEdgeChoke"),c2id("#Prc"),Math.abs(edgeChoke));desc.putBoolean(s2id("refineEdgeAutoRadius"),edgeAutoRadius);desc.putBoolean(s2id("refineEdgeDecontaminate"),edgeDecontaminate);desc.putEnumerated(s2id("refineEdgeOutput"),s2id("refineEdgeOutput"),s2id("refineEdgeOutputUserMask"));executeAction(s2id("refineSelectionEdge"),desc,_dialogModesNo);return layers;};layers.masks.invertLayerMask=function(layerId){layers.masks.makeLayerMaskVisible(layerId,true);executeAction(c2id("Invr"),undefined,DialogModes.NO);layers.masks.makeLayerMaskVisible(layerId,false);return layers;};layers.rasterize=function(layerId){var rasterizeLayerId=s2id("rasterizeLayer");layers.stack.saveActiveIds(rasterizeLayerId);layers.stack.makeActive(layerId);if(layers.isGroup(layerId)){layers.groups.merge(layerId);}else{var desc=new ActionDescriptor();desc.putReference(c2id("null"),layers.ref());executeAction(s2id("rasterizeLayer"),desc,_dialogModesNo);}layers.stack.restoreIdList(rasterizeLayerId);return layers;};layers.setLocked=function(layerId,setLocked){setLocked=(setLocked!==false);layers.prop(layerId,"allLocked",setLocked);return layers;};layers.toggleIsolate=function(layerId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var list=new ActionList();list.putReference(ref);var desc=new ActionDescriptor();desc.putList(c2id("null"),list);desc.putBoolean(c2id("TglO"),true);executeAction(c2id("Shw "),desc,_dialogModesNo);return layers;},Lifter.layers=layers;log.log("Lifter.layers done...");}());(function(){log.log("LOADING Lifter.selection ...");var selection={};_doSelectionFromLayer=function(layerId,maskType,selectionType){var desc=new ActionDescriptor(),refFrom=new ActionReference(),refTo=new ActionReference(),execId=c2id("setd"),isVector=false;refFrom.putProperty(c2id("Chnl"),c2id("fsel"));switch(maskType){case LifterMaskType.TRANSPARENCY:refTo.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Trsp"));break;case LifterMaskType.LAYERMASK:refTo.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));break;case LifterMaskType.VECTORMASK:refTo.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));isVector=true;break;default:throw new Error("Unknown LifterMaskType: "+maskType);}if(typeof layerId!=="number"||layerId===0){refTo.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{refTo.putIdentifier(c2id("Lyr "),layerId);}switch(selectionType){case SelectionType.REPLACE:desc.putReference(c2id("null"),refFrom);desc.putReference(c2id("T   "),refTo);execId=c2id("setd");break;case SelectionType.EXTEND:if(isVector){desc.putReference(c2id("null"),refFrom);desc.putReference(c2id("T   "),refTo);execId=c2id("AddT");}else{desc.putReference(c2id("null"),refTo);desc.putReference(c2id("T   "),refFrom);execId=c2id("Add ");}break;case SelectionType.DIMINISH:if(isVector){desc.putReference(c2id("null"),refFrom);desc.putReference(c2id("T   "),refTo);execId=c2id("SbtF");}else{desc.putReference(c2id("null"),refTo);desc.putReference(c2id("From"),refFrom);execId=c2id("Sbtr");}break;case SelectionType.INTERSECT:if(isVector){desc.putReference(c2id("null"),refFrom);desc.putReference(c2id("T   "),refTo);execId=c2id("IntW");}else{desc.putReference(c2id("null"),refTo);desc.putReference(c2id("With"),refFrom);execId=c2id("Intr");}break;default:throw new Error("Unknown SelectionType: "+selectionType);}if(isVector){desc.putInteger(c2id("Vrsn"),1);desc.putBoolean(s2id("vectorMaskParams"),true);}executeAction(execId,desc,DialogModes.NO);};selection.exists=function(){try{return(app.activeDocument.selection.bounds.length>0);}catch(err){return false;}};selection.selectAll=function(){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putEnumerated(c2id("T   "),c2id("Ordn"),c2id("Al  "));executeAction(c2id("setd"),desc,_dialogModesNo);return selection;};selection.copy=function(merged){if(merged){executeAction(c2id("CpyM"),undefined,_dialogModesNo);}else{executeAction(c2id("copy"),undefined,_dialogModesNo);}return selection;};selection.paste=function(inPlace){var desc=new ActionDescriptor();if(inPlace){desc.putBoolean(s2id("inPlace"),inPlace);}desc.putEnumerated(c2id("AntA"),c2id("Annt"),c2id("Anno"));executeAction(c2id("past"),desc,_dialogModesNo);return selection;};selection.pasteInto=function(){var desc=new ActionDescriptor();desc.putEnumerated(c2id("AntA"),c2id("Annt"),c2id("Anno"));executeAction(c2id("PstI"),desc,_dialogModesNo);return selection;};selection.pasteOutside=function(){var desc=new ActionDescriptor();desc.putEnumerated(c2id("AntA"),c2id("Annt"),c2id("Anno"));executeAction(c2id("PstO"),desc,_dialogModesNo);return selection;};selection.pasteToNewDocument=function(name){var desc=new ActionDescriptor();desc.putString(s2id("preset"),"Clipboard");if(typeof name==="string"&&name.length){desc3.putString(c2id("Nm  "),name);}var desc2=new ActionDescriptor();desc2.putObject(c2id("Nw  "),c2id("Dcmn"),desc);executeAction(c2id("Mk  "),desc2,_dialogModesNo);selection.paste();if(Lifter.documents){Lifter.documents.flatten();}return selection;};selection.clear=function(){executeAction(c2id("Dlt "),undefined,_dialogModesNo);return selection;};selection.invert=function(){executeAction(c2id("Invs"),undefined,_dialogModesNo);return selection;};selection.deselect=function(){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putEnumerated(c2id("T   "),c2id("Ordn"),c2id("None"));executeAction(c2id("setd"),desc,_dialogModesNo);return selection;};selection.store=function(channelName,combination){var channel;combination=combination||SelectionType.REPLACE;if(!selection.exists()){throw new Error("No canvas selection to store.");}try{channel=app.activeDocument.channels.getByName(channelName);}catch(err){var desc93=new ActionDescriptor();desc93.putString(c2id("Nm  "),channelName);var ref22=new ActionReference();ref22.putProperty(c2id("Chnl"),c2id("fsel"));desc93.putReference(c2id("null"),ref22);executeAction(c2id("Dplc"),desc93,DialogModes.NO);channel=app.activeDocument.channels.getByName(channelName);}app.activeDocument.selection.store(channel,combination);return selection;};selection.load=function(channelName,combination,remove){var channel=app.activeDocument.channels.getByName(channelName);combination=combination||SelectionType.REPLACE;var dlgMode=app.displayDialogs;try{app.displayDialogs=DialogModes.NO;app.activeDocument.selection.load(channel,combination);}catch(err){log.error(err);log.warn($.stack);throw err;}finally{app.displayDialogs=dlgMode;}if(remove){channel.remove();}return selection;};selection.fromVisiblePixels=function(combination){if(!Lifter.layers){throw new Error("Lifter.selection.fromLayerMask requires the Lifter.layers library.");}try{selection.selectAll().copy(true).paste(true);selection.fromLayerTransparency(combination);Lifter.layers.remove();}catch(error){throw new Error("Unable to make selection from layers. Likely no pixels selected.");}finally{return selection;}};selection.fromLayerTransparency=function(){_overloadFunction_Number_Obj(arguments,undefined,SelectionType.REPLACE);var layerId=arguments[0],combination=arguments[1];if(!Lifter.layers){throw new Error("Lifter.selection.fromLayerMask requires the Lifter.layers library.");}_doSelectionFromLayer(layerId,LifterMaskType.TRANSPARENCY,combination);return selection;};selection.fromLayerMask=function(){_overloadFunction_Number_Obj(arguments,undefined,SelectionType.REPLACE);var layerId=arguments[0],combination=arguments[1];if(!Lifter.layers){throw new Error("Lifter.selection.fromLayerMask requires the Lifter.layers library.");}if(Lifter.layers.masks.hasLayerMask(layerId)==false){throw new Error("Layer "+Lifter.layers.prop(layerId,"name")+" has no layer mask to select.");}_doSelectionFromLayer(layerId,LifterMaskType.LAYERMASK,combination);return selection;};selection.fromVectorMask=function(){_overloadFunction_Number_Obj(arguments,undefined,SelectionType.REPLACE);var layerId=arguments[0],combination=arguments[1];if(!Lifter.layers){throw new Error("Lifter.selection.fromLayerMask requires the Lifter.layers library.");}if(Lifter.layers.masks.hasVectorMask(layerId)==false){throw new Error("Layer "+Lifter.layers.prop(layerId,"name")+" has no vector mask to select.");}_doSelectionFromLayer(layerId,LifterMaskType.VECTORMASK,combination);return selection;};Lifter.selection=selection;log.log("Lifter.selection done.");}());(function(){log.log("LOADING Lifter.system ...");var system={};system.isWindows=function isWindows(){return $.os.match(/windows/i);};system.isMac=function isMac(){return !system.isWindows();};system.files={};system.files.getFile=_ensureFile;system.files.isDirectory=system.files.isFolder=function isDirectory(myDir){return(File(myDir) instanceof Folder);};system.files.browseTo=function browseTo(theFile){var cmd;var isDir=system.files.isDirectory(theFile);if(system.isMac()){cmd=(isDir)?"open ":"open -R ";}else{cmd=(isDir)?"explorer.exe /n, ":"explorer.exe /select, ";}cmd+='"'+new File(theFile).fsName+'"';log.info("Browse to command: "+cmd);app.system(cmd);};system.files.eval=function(inFile){inFile=_ensureFile(inFile);var jsxFiles=[inFile];if(File(inFile) instanceof Folder){jsxFiles=Folder(inFile).getFiles("*.jsx");}jsxFiles.forEach(_evalFile);return inFile;};system.files.maskTest=function(fileName,masks,isExclude){if(!masks||!masks.length){return true;}var reMask;var result=(!isExclude)?false:true;if(typeof masks==="string"){masks=[masks];}for(var m=0;m<masks.length;m++){reMask=masks[m];if(typeof reMask=="string"){reMask=reMask.replace(/\./g,"\\.").replace(/\*/g,".*");reMask=new RegExp(reMask+"$");}if(typeof reMask=="function"&&fileName.search(reMask)!==-1){result=(!isExclude)?true:false;break;}}return result;};system.files.excludeTest=function(fileName,masks){return system.files.maskTest(fileName,masks,true);};system.files.makeDir=function makeDir(inFolder){inFolder=new Folder(inFolder);if(!inFolder.exists){log.log("Creating new folder: "+inFolder.fsName);try{if(inFolder.create()===false){log.error("copyFiles: error creating directory "+inFolder.fsName);return 0;}}catch(e){log.error(e.message);return 0;}}else{if(inFolder.readonly){log.error("copyFiles: directory is read only "+inFolder.fsName);return 0;}}return 1;};system.files.removeDir=function removeDir(srcFolder){srcFolder=new Folder(srcFolder);if(srcFolder.exists){srcFiles=srcFolder.getFiles();log.log("\n---  system.files.removeDir  ---");log.log("Folder: "+srcFolder);log.log("Items: "+srcFiles.length);srcFiles.forEach(function(srcFile){log.log(" - "+srcFile.name);});srcFiles.forEach(function(srcFile){if(srcFile instanceof File){remResult=srcFile.remove();}else{if(srcFile instanceof Folder){system.files.removeDir(srcFile);}else{log.log("Don't know if I can remove this?\n"+srcFile);}}});return srcFolder.remove();}return 1;};system.files.copy=function copyFiles(src,dst,options){var srcFile=new File(src);var dstFile=new File(dst);if(File(srcFile) instanceof Folder){return system.files.copyDir(src,dst,options);}if(File(dstFile) instanceof Folder){dstFile=new File(dstFile.fsName+"/"+srcFile.name);}var newFile;var newFileName,newFilePath;var newFolder=dstFile.parent;if(typeof options!=="object"){options={};}options.defaults({overwrite:true,silent:false,unlock:true,masks:[],excludes:[],replacements:[],dialogId:1038876});var dialogId=1038876;var dialogArgs={id:dialogId,skippable:true,buttons:["OK","Skip"]};dialogArgs.title="Overwrite File?";dialogArgs.text="Do you want to overwrite existing files?";var dialogResult;Lifter.dialogs.clearCached(dialogId);log.log("\n[]------  system.files.copy()  ------[]\n");log.log("options:");for(var opt in options){if(!options.hasOwnProperty(opt)){continue;}log.log("-- "+opt+":"+options[opt]);}log.log("Src File: \n"+srcFile);log.log("Dst File: \n"+dstFile);log.log("srcFile.exists "+srcFile.exists);if(!srcFile.exists||srcFile.name===".DS_Store"){return;}if(!system.files.makeDir(newFolder)){return;}if(system.files.maskTest(srcFile.name,options.masks)===false){return;}if(system.files.excludeTest(srcFile.name,options.excludes)===false){return;}newFileName=dstFile.name;for(var r=0;r<options.replacements.length;r++){var rep=options.replacements[r];newFileName=newFileName.replace(new RegExp(rep[0],"g"),rep[1]);}newFilePath=newFolder.fsName+"/"+newFileName;log.log("\n-- Src:\n"+srcFile.fsName);log.log("\n-- Dst:\n"+new Folder(newFilePath).fsName);newFile=File(newFilePath);log.log("\n--- exists "+newFile.exists+" ---");if(newFile.exists&&options.silent===false&&typeof Lifter.dialogs.confirm==="function"){if(!newFile.readonly){dialogArgs.text='"'+newFile.name+'" already exists. Do you want to overwrite it?';}else{dialogArgs.text='"'+newFile.name+'" is set to Read-Only. It may be locked by Perforce. Do you want to overwrite it?';}dialogResult=Lifter.dialogs.confirm(dialogArgs);dialogCache=Lifter.dialogs.getCached(dialogId);options.overwrite=(dialogCache&&dialogCache.value!==1);options.silent=(dialogCache&&dialogCache.skip===true);log.log("dialogResult: "+(dialogResult));log.log("dialogCache: "+(dialogCache));}if(!newFile.exists||options.overwrite){try{srcFile.copy(newFilePath);}catch(e){log.error(e.message);return;}newFile=File(newFilePath);if(!newFile.exists){log.error("copyFiles:file not created "+newFilePath+", "+newFile.error);return;}if(options.unlock){newFile.readonly=false;}return newFile;}else{log.log("User skipped this one...");}};system.files.copyDir=function copyDir(src,dst,options){var srcFolder=(typeof src=="string")?new Folder(src):src;var newFolder=(typeof dst=="string")?new Folder(dst):dst;if(File(srcFolder) instanceof File){return[system.files.copy(src,dst,options)];}var srcFiles,srcFile;var newFileName,newFilePath;if(typeof options!=="object"){options={};}options.defaults({overwrite:true,silent:false,unlock:true,masks:[],excludes:[],replacements:[]});var result=[];log.log("\n[]------  copyFiles  ------[]\n");log.log("options: \n");for(var opt in options){if(!options.hasOwnProperty(opt)){continue;}log.log("-- "+opt+":"+options[opt]);}log.log("Src Dir: \n"+src);log.log("Dst Dir: \n"+dst);if(!srcFolder.exists){return;}if(!system.files.makeDir(newFolder)){return;}srcFiles=srcFolder.getFiles();log.log("Items: "+srcFiles.length);srcFiles.forEach(function(srcFile){log.log(" - "+srcFile.name);});for(var f in srcFiles){if(!srcFiles.hasOwnProperty(f)){continue;}srcFile=srcFiles[f];newFilePath=newFolder.fsName+"/"+srcFile.name;if(srcFile instanceof File){var newFile=system.files.copy(srcFile,newFilePath,options);if(newFile){result.concat(newFile);}}else{if(srcFile instanceof Folder){var newSubFolder=new Folder(newFilePath);try{if(newSubFolder.create()===false){log.error("copyFiles:error creating sub-directory "+newSubFolder.fsName);return;}}catch(e){log.error(e.message);return;}result=system.files.copyDir(srcFile,newSubFolder,options);}else{log.log("Skipping this one...");}}}return result;};system.files.remove=function copyFiles(src,dst,options){var srcFolder=(typeof src=="string")?new Folder(src):src;var newFolder=(typeof dst=="string")?new Folder(dst):dst;var srcFiles,srcFile,newFile;if(!srcFolder.exists){return;}log.log("\n[]------  copyFiles  ------[]\n");log.log("Src: \n"+srcFolder);srcFiles=srcFolder.getFiles();log.log("Items: "+srcFiles.length);srcFiles.forEach(function(srcFile){log.log(" - "+srcFile.name);});for(var f in srcFiles){if(!srcFiles.hasOwnProperty(f)){continue;}srcFile=srcFiles[f];}};Lifter.system=Lifter.sys=system;log.log("Lifter.system done.");}());log.log("Lifter is ready now.");}).call($.global);}
/*!
 * LIFTER IS READY NOW
 */
;